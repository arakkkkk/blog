<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>arakkk</title><link>http://192.168.122.81/</link><description>Recent content on arakkk</description><generator>Hugo -- gohugo.io</generator><language>ja-JP</language><lastBuildDate>Fri, 25 Jul 2025 00:00:00 +0000</lastBuildDate><atom:link href="http://192.168.122.81/index.xml" rel="self" type="application/rss+xml"/><item><title>踏み台サーバー経由でのAnsible実行</title><link>http://192.168.122.81/p/%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E7%B5%8C%E7%94%B1%E3%81%A7%E3%81%AEansible%E5%AE%9F%E8%A1%8C/</link><pubDate>Fri, 25 Jul 2025 00:00:00 +0000</pubDate><guid>http://192.168.122.81/p/%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E7%B5%8C%E7%94%B1%E3%81%A7%E3%81%AEansible%E5%AE%9F%E8%A1%8C/</guid><description>&lt;p>踏み台サーバー経由でAnsibleを実行する方法について、少し詰まったので備忘録&lt;/p>
&lt;h2 id="結論">結論
&lt;/h2>&lt;p>踏み台サーバーを使った多段SSHの設定として以下のパラメータを設定することで可能となります&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ansible_ssh_common_args: &amp;#39;-o ProxyCommand=&amp;#34;ssh -i {{ bastion_ssh_private_key_file }} -p {{ bastion_port }} {{ bastion_user }}@{{ bastion_host }} -W %h:%p&amp;#34;&amp;#39;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>サンプル: &lt;a class="link" href="https://github.com/arakkkkk/example-ansible-proxyjump" target="_blank" rel="noopener"
>arakkkkk/example-ansible-proxyjump&lt;/a>&lt;/p>
&lt;h2 id="構成">構成
&lt;/h2>&lt;p>以下の構成で、対象サーバーへ踏み台サーバー経由でAnsibleを実行します。&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E7%B5%8C%E7%94%B1%E3%81%A7%E3%81%AEansible%E5%AE%9F%E8%A1%8C/uploads/mermaid-diagram-1753458334769.png"
width="1953"
height="188"
srcset="http://192.168.122.81/p/%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E7%B5%8C%E7%94%B1%E3%81%A7%E3%81%AEansible%E5%AE%9F%E8%A1%8C/uploads/mermaid-diagram-1753458334769_hu_a6fe29ac4af0237d.png 480w, http://192.168.122.81/p/%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E7%B5%8C%E7%94%B1%E3%81%A7%E3%81%AEansible%E5%AE%9F%E8%A1%8C/uploads/mermaid-diagram-1753458334769_hu_489a9590f98a9bee.png 1024w"
loading="lazy"
alt="struc"
class="gallery-image"
data-flex-grow="1038"
data-flex-basis="2493px"
>&lt;/p>
&lt;!-- ```mermaid -->
&lt;!-- graph LR -->
&lt;pre>&lt;code>&amp;lt;!-- A[ローカルマシン&amp;lt;br/&amp;gt;Ansible実行サーバー] --&amp;gt;|SSH:2222&amp;lt;br&amp;gt;公開鍵認証| B[踏み台サーバー&amp;lt;br/&amp;gt;192.168.11.10] --&amp;gt;
&amp;lt;!-- B --&amp;gt;|SSH:2222&amp;lt;br&amp;gt;公開鍵認証/パスワード認証| C[対象サーバー&amp;lt;br/&amp;gt;192.168.122.70] --&amp;gt;
&lt;/code>&lt;/pre>
&lt;!-- ``` -->
&lt;h2 id="前提条件">前提条件
&lt;/h2>&lt;ul>
&lt;li>踏み台サーバーと対象サーバーの両方でSSH公開鍵認証が設定済み&lt;/li>
&lt;li>両サーバーともSSHポート2222で接続&lt;/li>
&lt;/ul>
&lt;h2 id="hosts設定-踏み台サーバー対象サーバー共に公開鍵認証">hosts設定 (踏み台サーバー/対象サーバー共に公開鍵認証)
&lt;/h2>&lt;p>&lt;code>hosts&lt;/code>ファイルに以下の設定を記述&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ini" data-lang="ini">&lt;span class="line">&lt;span class="cl">&lt;span class="na">ansible-client ansible_host&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">192.168.122.70 ansible_user=ubuntu ansible_ssh_private_key_file=~/.ssh/keys/id_ed25519 ansible_ssh_common_args=&amp;#39;-o ProxyCommand=&amp;#34;ssh -i ~/.ssh/keys/id_ed25519 -p 2222 ubuntu@192.168.11.10 -W %h:%p&amp;#34;&amp;#39; ansible_port=2222&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;a class="link" href="https://github.com/arakkkkk/example-ansible-proxyjump/blob/main/host_vars/ansible-client.yml" target="_blank" rel="noopener"
>ansible-client.yml&lt;/a>のようにhost_varsのymlに記載すると管理しやすいかと思います&lt;/p>
&lt;ul>
&lt;li>&lt;code>ansible_host&lt;/code>: 対象サーバーのIPアドレス&lt;/li>
&lt;li>&lt;code>ansible_user&lt;/code>: 対象サーバーのSSH接続ユーザー&lt;/li>
&lt;li>&lt;code>ansible_ssh_private_key_file&lt;/code>: 秘密鍵ファイルのパス&lt;/li>
&lt;li>&lt;code>ansible_port&lt;/code>: 対象サーバーのSSHポート&lt;/li>
&lt;li>&lt;code>ansible_ssh_common_args&lt;/code>: SSH接続時の追加オプション (踏み台へのSSH接続情報)
&lt;ul>
&lt;li>&lt;code>ProxyCommand&lt;/code>: 踏み台サーバー経由での接続コマンド&lt;/li>
&lt;li>&lt;code>-W %h:%p&lt;/code>: ポートフォワーディング設定&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="hosts設定-踏み台サーバーは公開鍵認証対象サーバーはパスワード認証">hosts設定 (踏み台サーバーは公開鍵認証、対象サーバーはパスワード認証)
&lt;/h2>&lt;p>踏み台サーバーには証明書認証、対象サーバーにはパスワード認証という場合でもAnsibleによる実行は可能です。&lt;/p>
&lt;p>&lt;code>ansible_ssh_private_key_file&lt;/code>パラメータを削除し、実行時に&lt;code>--ask-pass&lt;/code>をつけて実行時にパスワードを入力して実行が可能です。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ini" data-lang="ini">&lt;span class="line">&lt;span class="cl">&lt;span class="na">ansible-client ansible_host&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">192.168.122.70 ansible_user=ubuntu ansible_ssh_common_args=&amp;#39;-o ProxyCommand=&amp;#34;ssh -i ~/.ssh/keys/id_ed25519 -p 2222 ubuntu@192.168.11.10 -W %h:%p&amp;#34;&amp;#39; ansible_port=2222&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Ansible Vault等でパスワードを保存している場合、&lt;code>ansible_ssh_pass&lt;/code>パラメータとして用意しておくことも可能です&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ini" data-lang="ini">&lt;span class="line">&lt;span class="cl">&lt;span class="na">ansible-client ansible_host&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">192.168.122.70 ansible_user=ubuntu ansible_ssh_common_args=&amp;#39;-o ProxyCommand=&amp;#34;ssh -i ~/.ssh/keys/id_ed25519 -p 2222 ubuntu@192.168.11.10 -W %h:%p&amp;#34;&amp;#39; ansible_ssh_pass={{ vault_bastion_pass }} ansible_port=2222&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>※ただし、上記方式での実行には&lt;code>sshpass&lt;/code>のインストールが必要です&lt;/p></description></item><item><title>NeovimでAIコーディング (Avante編)</title><link>http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-avante%E7%B7%A8/</link><pubDate>Mon, 07 Jul 2025 00:00:00 +0000</pubDate><guid>http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-avante%E7%B7%A8/</guid><description>&lt;h1 id="neovimでavanteを使いたい人向けのガイド202575時点">NeovimでAvanteを使いたい人向けのガイド(2025/7/5時点)
&lt;/h1>&lt;p>前回はCopilot.luaについて書いたので、今回はAvanteについて紹介してみます。&lt;/p>
&lt;h2 id="neovimのavanteプラグインでできること">NeovimのAvanteプラグインでできること
&lt;/h2>&lt;h3 id="チャットモード">チャットモード
&lt;/h3>&lt;p>Avanteでは、コードの質問のみ行う&lt;code>:AvanteAsk&lt;/code>と、編集を同時に行える&lt;code>:AvanteChat&lt;/code>のコマンドが用意されています。&lt;br>
&lt;code>:AvanteChat&lt;/code>では、チャットをしながらコードの変更が可能です。CopilotChatのAgentモード相当の機能を有しており、複数ファイルの編集や、ファイル作成も行ってくれます。&lt;br>
また、コードの差分も見やすく表示されるので使い勝手は非常に良いです。
&lt;img src="http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-avante%E7%B7%A8/uploads/avante_chat.png"
width="2119"
height="1375"
srcset="http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-avante%E7%B7%A8/uploads/avante_chat_hu_845a2678f3a3451a.png 480w, http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-avante%E7%B7%A8/uploads/avante_chat_hu_2529d9bb75c23db9.png 1024w"
loading="lazy"
alt="avante_chat"
class="gallery-image"
data-flex-grow="154"
data-flex-basis="369px"
>&lt;/p>
&lt;p>部分的に編集したければ、&lt;code>:AvanteEdit&lt;/code>を以下画像のように利用することも可能です。
&lt;img src="http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-avante%E7%B7%A8/uploads/avante_edit.png"
width="1259"
height="382"
srcset="http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-avante%E7%B7%A8/uploads/avante_edit_hu_cb861060a183fdcb.png 480w, http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-avante%E7%B7%A8/uploads/avante_edit_hu_fdb1e1947760bdee.png 1024w"
loading="lazy"
alt="avante_edit"
class="gallery-image"
data-flex-grow="329"
data-flex-basis="790px"
>&lt;/p>
&lt;p>また、mcphub.nvimを利用することでMCPも利用可能です。こちらはまだ試せていないので、別記事にて紹介しようと思います。
&lt;a class="link" href="https://ravitemer.github.io/mcphub.nvim/extensions/avante.html" target="_blank" rel="noopener"
>https://ravitemer.github.io/mcphub.nvim/extensions/avante.html&lt;/a>&lt;/p>
&lt;h2 id="設定方法">設定方法
&lt;/h2>&lt;p>ここでは &lt;code>lazy.nvim&lt;/code> を使った設定方法を記載しています。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-lua" data-lang="lua">&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;yetone/avante.nvim&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">build&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">function&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">-- conditionally use the correct build system for the current OS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">if&lt;/span> &lt;span class="n">vim.fn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">has&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;win32&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="kr">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">return&lt;/span> &lt;span class="s2">&amp;#34;powershell -ExecutionPolicy Bypass -File Build.ps1 -BuildFromSource false&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">else&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">return&lt;/span> &lt;span class="s2">&amp;#34;make&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">end&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dependencies&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;nvim-treesitter/nvim-treesitter&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;stevearc/dressing.nvim&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;nvim-lua/plenary.nvim&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;MunifTanjim/nui.nvim&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ops&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">---@alias Provider &amp;#34;claude&amp;#34; | &amp;#34;openai&amp;#34; | &amp;#34;azure&amp;#34; | &amp;#34;gemini&amp;#34; | &amp;#34;cohere&amp;#34; | &amp;#34;copilot&amp;#34; | string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">provider&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;copilot&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="avanteで使えるプロンプトの接頭辞">Avanteで使えるプロンプトの接頭辞
&lt;/h2>&lt;h3 id="mentions">&lt;code>@mentions&lt;/code>
&lt;/h3>&lt;p>&lt;code>@mentions&lt;/code>を使うことでプロンプトに情報を追加することができます&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Mention&lt;/th>
&lt;th>説明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>@codebase&lt;/td>
&lt;td>プロジェクト全体のソースコード&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>@diagnostics&lt;/td>
&lt;td>diagnosticの情報&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>@file&lt;/td>
&lt;td>特定のファイル&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>@quickfix&lt;/td>
&lt;td>quickfix&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>@buffers&lt;/td>
&lt;td>buffers&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;code>@codebase&lt;/code>と&lt;code>@file&lt;/code>がよく使うメンションになるかと思います。また、&lt;code>@file&lt;/code>については以下画像のようにファイルの検索が可能で便利です。
&lt;img src="http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-avante%E7%B7%A8/uploads/avante_mention_file.png"
width="1246"
height="507"
srcset="http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-avante%E7%B7%A8/uploads/avante_mention_file_hu_a319d7b619b1c027.png 480w, http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-avante%E7%B7%A8/uploads/avante_mention_file_hu_8de35986bee257f1.png 1024w"
loading="lazy"
alt="avante_mention_file"
class="gallery-image"
data-flex-grow="245"
data-flex-basis="589px"
>&lt;/p>
&lt;h3 id="heading">&lt;code>/&lt;/code>
&lt;/h3>&lt;p>スラッシュコマンドを使うことで特定の機能を呼び出すことができます&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Mention&lt;/th>
&lt;th>説明&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>/help&lt;/td>
&lt;td>ヘルプを表示します&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/lines&lt;/td>
&lt;td>特定の行について質問します（例: /lines &lt;start>-&lt;end> &amp;lt;質問&amp;gt;）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/new&lt;/td>
&lt;td>新しいチャットを開始します&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/init&lt;/td>
&lt;td>現在のプロジェクトに基づいてAGENTS.mdを初期化します&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/clear&lt;/td>
&lt;td>チャット履歴をクリアします&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/commit&lt;/td>
&lt;td>変更をコミットします&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>/compact&lt;/td>
&lt;td>トークン節約のため履歴メッセージを圧縮します&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;code>/commit&lt;/code>は自動で作成してコミットしてくれるので便利です。但し、&lt;code>git add&lt;/code>、&lt;code>git push&lt;/code>は自身で行う必要があります。&lt;/p>
&lt;h2 id="まとめ">まとめ
&lt;/h2>&lt;p>Copilot.luaと比較すると機能がかなり豊富になっていることがわかったかと思います。&lt;/p>
&lt;p>チャットモードによるファイル編集・ファイル作成、部分的な編集ができるとともに、MCPも利用することができるのでこのプラグインを上手に活用できればVS Codeに劣らずAIを用いたコーディングができるプラグインになっているかと思います。&lt;/p>
&lt;p>但し、難点としてチャットの回答が体感遅いのでこちらは我慢が必要です。(もしくは、copilotで試していたので他のモデルを利用することで改善するかもしれません。)&lt;/p></description></item><item><title>NeovimでAIコーディング (Copilot編)</title><link>http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-copilot%E7%B7%A8/</link><pubDate>Sat, 05 Jul 2025 00:00:00 +0000</pubDate><guid>http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-copilot%E7%B7%A8/</guid><description>&lt;h1 id="neovimでcopilotを使いたい人向けのガイド202575時点">NeovimでCopilotを使いたい人向けのガイド(2025/7/5時点)
&lt;/h1>&lt;p>前回の記事で、NeovimのAIコーディング用プラグインを比較しました。今回はそのうちのCopilot.luaについてもう少し詳しく紹介しようと思います。&lt;/p>
&lt;h2 id="neovimのcopilotプラグインでできること">NeovimのCopilotプラグインでできること
&lt;/h2>&lt;h3 id="補完機能">補完機能
&lt;/h3>&lt;p>利用している補完用プラグインとの連携も可能です。
&lt;div class="video-wrapper">
&lt;video
controls
src="uploads/copilot_completion.mp4"
>
&lt;p>
Your browser doesn't support HTML5 video. Here is a
&lt;a href="uploads/copilot_completion.mp4">link to the video&lt;/a> instead.
&lt;/p>
&lt;/video>
&lt;/div>
&lt;/p>
&lt;h3 id="チャットモード-askモードに相当する機能">チャットモード (Askモードに相当する機能)
&lt;/h3>&lt;p>指定した行/ファイル/バッファに対してチャットでのやり取りが可能です。変更に対する差分の確認や反映もできます。
&lt;div class="video-wrapper">
&lt;video
controls
src="uploads/copilot_chat.mp4"
>
&lt;p>
Your browser doesn't support HTML5 video. Here is a
&lt;a href="uploads/copilot_chat.mp4">link to the video&lt;/a> instead.
&lt;/p>
&lt;/video>
&lt;/div>
&lt;/p>
&lt;p>また、便利な機能としてプロンプトを事前に用意しておくことができ、スラッシュコマンドで呼び出して利用することができます
&lt;img src="http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-copilot%E7%B7%A8/uploads/copilot_slash.png"
width="1459"
height="454"
srcset="http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-copilot%E7%B7%A8/uploads/copilot_slash_hu_6fb261fdcae3e2d7.png 480w, http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-copilot%E7%B7%A8/uploads/copilot_slash_hu_f6a622cbb0b0f262.png 1024w"
loading="lazy"
alt="copilot_slash"
class="gallery-image"
data-flex-grow="321"
data-flex-basis="771px"
>&lt;/p>
&lt;p>また、telescopeと連携することでエディターからプロンプトを直接呼び出すことも可能です。これは他のプラグインにはなかなかない機能で便利だと感じました。&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-copilot%E7%B7%A8/uploads/copilot_telscope.png"
width="1315"
height="1230"
srcset="http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-copilot%E7%B7%A8/uploads/copilot_telscope_hu_b9f6ea9477b33023.png 480w, http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-copilot%E7%B7%A8/uploads/copilot_telscope_hu_68c8a596b1f2f245.png 1024w"
loading="lazy"
alt="copilot_telscope"
class="gallery-image"
data-flex-grow="106"
data-flex-basis="256px"
>&lt;/p>
&lt;h2 id="neovimのcopilotプラグインでできないこと">NeovimのCopilotプラグインでできないこと
&lt;/h2>&lt;h3 id="aiエージェントによるファイル作成や複数ファイルの編集">AIエージェントによるファイル作成や複数ファイルの編集
&lt;/h3>&lt;p>VSCodeのCopilotChatにおけるAgentモードに相当する機能は現状利用ができません&lt;/p>
&lt;h2 id="設定方法">設定方法
&lt;/h2>&lt;p>ここでは &lt;code>lazy.nvim&lt;/code> を使った設定方法を記載しています。&lt;/p>
&lt;h3 id="copilot">Copilot
&lt;/h3>&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/zbirenbaum/copilot.lua" target="_blank" rel="noopener"
>zbirenbaum/copilot.lua&lt;/a>&lt;/li>
&lt;li>&lt;code>:Copilot auth&lt;/code> で認証を行います。&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-lua" data-lang="lua">&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;zbirenbaum/copilot.lua&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cmd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;Copilot&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">event&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;InsertEnter&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">function&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;copilot&amp;#34;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">setup&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">suggestion&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">false&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">panel&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">enabled&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">false&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">auto_trigger&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">end&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="copilot-cmp">copilot-cmp
&lt;/h3>&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/zbirenbaum/copilot-cmp?tab=readme-ov-file#configuration" target="_blank" rel="noopener"
>zbirenbaum/copilot-cmp&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>利用している補完用プラグインによって、必要な追加設定が異なります。&lt;br>
詳細は &lt;a class="link" href="https://github.com/zbirenbaum/copilot-cmp?tab=readme-ov-file#configuration" target="_blank" rel="noopener"
>こちら&lt;/a> を参考にしてください。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-lua" data-lang="lua">&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;zbirenbaum/copilot-cmp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">function&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;copilot_cmp&amp;#34;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">setup&lt;/span>&lt;span class="p">({})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">end&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="copilotchat">CopilotChat
&lt;/h3>&lt;ul>
&lt;li>&lt;a class="link" href="https://github.com/CopilotC-Nvim/CopilotChat.nvim" target="_blank" rel="noopener"
>CopilotC-Nvim/CopilotChat.nvim&lt;/a>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-lua" data-lang="lua">&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;CopilotC-Nvim/CopilotChat.nvim&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">branch&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;main&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cmd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="s2">&amp;#34;CopilotChat&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;CopilotChatOpen&amp;#34;&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">build&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;make tiktoken&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">-- Only on MacOS or Linux&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">function&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;configs.copilot-chat&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">end&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="copilotchatで使えるプロンプトの接頭辞">CopilotChatで使えるプロンプトの接頭辞
&lt;/h2>&lt;p>CopilotChatでは、プロンプトでの接頭辞を活用できます。&lt;/p>
&lt;h3 id="1---プリセットスラッシュコマンド">1. &lt;code>/&lt;/code> — &lt;strong>プリセット／スラッシュコマンド&lt;/strong>
&lt;/h3>&lt;p>&lt;code>/&lt;/code> に続けてコマンド名やプリセット名を書くと、あらかじめ用意された定型プロンプトを呼び出せます。&lt;/p>
&lt;ul>
&lt;li>例: &lt;code>/Explain&lt;/code> → 選択中のコードの解説を依頼&lt;/li>
&lt;li>例: &lt;code>/Tests&lt;/code> → 単体テストを生成&lt;/li>
&lt;li>例: &lt;code>/Fix&lt;/code> → バグ修正提案&lt;/li>
&lt;/ul>
&lt;p>利用できるプリセットは環境や設定に応じて異なり、&lt;code>/&lt;/code> を入力すると候補がポップアップします。&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-copilot%E7%B7%A8/uploads/copilot_slash.png"
width="1459"
height="454"
srcset="http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-copilot%E7%B7%A8/uploads/copilot_slash_hu_6fb261fdcae3e2d7.png 480w, http://192.168.122.81/p/neovim%E3%81%A7ai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0-copilot%E7%B7%A8/uploads/copilot_slash_hu_f6a622cbb0b0f262.png 1024w"
loading="lazy"
alt="copilot_slash"
class="gallery-image"
data-flex-grow="321"
data-flex-basis="771px"
>&lt;/p>
&lt;h3 id="2---コンテキスト変数context">2. &lt;code>#&lt;/code> — &lt;strong>コンテキスト変数（Context）&lt;/strong>
&lt;/h3>&lt;p>&lt;code>#&lt;/code> に続けてコンテキスト名と必要に応じて入力を指定することで、チャットに「追加情報」を渡せます。以下のようなものがあります：&lt;/p>
&lt;ul>
&lt;li>&lt;code>#buffer&lt;/code> … 現在のバッファ内容&lt;/li>
&lt;li>&lt;code>#buffer:2&lt;/code> … バッファ番号 2 の内容&lt;/li>
&lt;li>&lt;code>#files:*.js&lt;/code> … ワークスペース内の &lt;code>*.js&lt;/code> ファイル全体&lt;/li>
&lt;li>&lt;code>#git:staged&lt;/code> … ステージされた git diff&lt;/li>
&lt;li>&lt;code>#url:https://…&lt;/code> … 指定 URL の内容取得&lt;/li>
&lt;/ul>
&lt;p>AI は必要に応じて「このコンテキストが欲しい」と提案してくることもあります。&lt;/p>
&lt;h3 id="3---スティッキープロンプトsticky-prompt">3. &lt;code>&amp;gt;&lt;/code> — &lt;strong>スティッキープロンプト（Sticky Prompt）&lt;/strong>
&lt;/h3>&lt;p>Markdown の引用記法と同じく行頭に &lt;code>&amp;gt;&lt;/code> を置くと、そのプロンプトは「スティッキー（常に貼り付け）」として保持され、&lt;strong>新しいチャットを始めるたびに自動で先頭に挿入&lt;/strong>されます。&lt;/p>
&lt;ul>
&lt;li>
&lt;p>例:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;gt; You are a helpful coding assistant.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt; Please respond concisely.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>とすると、どんな質問をしても毎回この指示が一番最初に送られます。&lt;br>
設定ファイルでデフォルトのスティッキープロンプトを登録することも可能です。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>これらを組み合わせることで、&lt;/p>
&lt;ul>
&lt;li>&lt;code>/Review #buffer&lt;/code> のように「現在のバッファをレビューしてほしい」&lt;/li>
&lt;li>事前に &lt;code>&amp;gt; markdown&lt;/code> を貼って「以降の回答を Markdown 形式で」
…といった柔軟なチャット操作が可能になります。&lt;/li>
&lt;/ul>
&lt;h2 id="まとめ">まとめ
&lt;/h2>&lt;p>AIの補完機能については、競合が少なくCopilot.luaが無難な選択肢になりそうです。&lt;br>
また、CopilotChatは機能としてはシンプルで、まだAIを使ったコーディングを行ったことがない方にとっては取り入れやすいプラグインかと思います。&lt;/p>
&lt;p>但し、Askモード相当の機能しかないため、がっつりコードを書く人にとっては機能的に物足りないプラグインという感想です。&lt;br>
まだ開発も続いていそうなのでまた大きなアップデートが来たら記事にしてみたいと思います。&lt;/p></description></item><item><title>Neovimで使えるAIコーディング支援プラグイン比較【2025年版】</title><link>http://192.168.122.81/p/neovim%E3%81%A7%E4%BD%BF%E3%81%88%E3%82%8Bai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E6%94%AF%E6%8F%B4%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E6%AF%94%E8%BC%832025%E5%B9%B4%E7%89%88/</link><pubDate>Fri, 20 Jun 2025 00:00:00 +0000</pubDate><guid>http://192.168.122.81/p/neovim%E3%81%A7%E4%BD%BF%E3%81%88%E3%82%8Bai%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E6%94%AF%E6%8F%B4%E3%83%97%E3%83%A9%E3%82%B0%E3%82%A4%E3%83%B3%E6%AF%94%E8%BC%832025%E5%B9%B4%E7%89%88/</guid><description>&lt;h2 id="neovim-aiコーディング用プラグイン20250620">Neovim AIコーディング用プラグイン（2025/06/20）
&lt;/h2>&lt;p>他にも様々あるかと思いますが、コーディングのサポートがあり、GitHubのスター数が1k以上ということを基準に探してみました。&lt;/p>
&lt;h2 id="-比較対象プラグイン">🔍 比較対象プラグイン
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>avante.nvim&lt;/strong>&lt;/li>
&lt;li>&lt;strong>Copilot.vnim (+CopilotChat.nvim)&lt;/strong>&lt;/li>
&lt;li>&lt;strong>codecompanion.nvim&lt;/strong>&lt;/li>
&lt;/ul>
&lt;h2 id="-機能比較表">📊 機能比較表
&lt;/h2>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>プラグイン名&lt;/th>
&lt;th>GitHub Star&lt;/th>
&lt;th>補完機能&lt;/th>
&lt;th>チャットモード&lt;/th>
&lt;th>ファイル作成&lt;/th>
&lt;th>複数ファイル同時編集&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>avante.nvim&lt;/td>
&lt;td>14.9k&lt;/td>
&lt;td>×&lt;/td>
&lt;td>◯&lt;/td>
&lt;td>◯&lt;/td>
&lt;td>✕&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>CopilotChat.nvim&lt;/td>
&lt;td>3K(3.5k)&lt;/td>
&lt;td>◯&lt;/td>
&lt;td>◯&lt;/td>
&lt;td>✕&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>codecompanion.nvim&lt;/td>
&lt;td>4.4k&lt;/td>
&lt;td>×&lt;/td>
&lt;td>◯&lt;/td>
&lt;td>✅ Slashで新規作成可&lt;/td>
&lt;td>✅ 複数チャット同時 ＆ ワークフロー可能&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;hr>
&lt;h2 id="-詳細な解説">💡 詳細な解説
&lt;/h2>&lt;h3 id="avantenvim">avante.nvim
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>スター数&lt;/strong>：約1.3K ([github.com][1], [github.com][2], [neovim.discourse.group][3])&lt;/li>
&lt;li>&lt;strong>補完機能&lt;/strong>：完全なインライン補完ではなく、チャットで差分を提案 → &lt;strong>diff形式で即適用&lt;/strong>&lt;/li>
&lt;li>&lt;strong>チャットモード&lt;/strong>：あり。対話形式でdiff提案 &lt;/li>
&lt;li>&lt;strong>ワークスペース読み込み&lt;/strong>：基本的には&lt;strong>現在のファイルのみ&lt;/strong>&lt;/li>
&lt;li>&lt;strong>ファイル作成&lt;/strong>：未対応&lt;/li>
&lt;li>&lt;strong>複数ファイル対応&lt;/strong>：diffは単一ファイル中心&lt;/li>
&lt;/ul>
&lt;h3 id="copilotchatnvim">CopilotChat.nvim
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>スター数&lt;/strong>：約3K &lt;/li>
&lt;li>&lt;strong>補完機能&lt;/strong>：copilot.lua 経由でインライン補完&lt;/li>
&lt;li>&lt;strong>チャットモード&lt;/strong>：あり。チャットUI＋diff 組み込み ([github.com][4])&lt;/li>
&lt;li>&lt;strong>ワークスペース読み込み&lt;/strong>：Smart embedding によるバッファ/ファイル全体の読み込み ([github.com][4])&lt;/li>
&lt;li>&lt;strong>ファイル作成&lt;/strong>：難しいが Quickfix 連携で実質可能&lt;/li>
&lt;li>&lt;strong>複数ファイル対応&lt;/strong>：Quickfix／複数バッファ処理で対応&lt;/li>
&lt;/ul>
&lt;h3 id="codecompanionnvim">codecompanion.nvim
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>スター数&lt;/strong>：約4.4K ([github.com][4])&lt;/li>
&lt;li>&lt;strong>補完機能&lt;/strong>：インライン補完対応（複数LLM）&lt;/li>
&lt;li>&lt;strong>チャットモード&lt;/strong>：あり。チャットバッファ、エージェント機能 ([github.com][5])&lt;/li>
&lt;li>&lt;strong>ワークスペース読み込み&lt;/strong>：バッファ、LSP、ツール／ワークフローにも対応 &lt;/li>
&lt;li>&lt;strong>ファイル作成&lt;/strong>：Slash Commands 等で&lt;strong>新規ファイル生成に対応&lt;/strong>&lt;/li>
&lt;li>&lt;strong>複数ファイル対応&lt;/strong>：複数チャット、エージェントで同時操作が可能&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="-おすすめ用途ごとに選ぶなら">🧭 おすすめ用途ごとに選ぶなら？
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>diffで提案 → すぐ適用したい人&lt;/strong>：&lt;code>avante.nvim&lt;/code>&lt;/li>
&lt;li>&lt;strong>Copilot Chat を Neovim で使いたい人&lt;/strong>：&lt;code>CopilotChat.nvim&lt;/code>&lt;/li>
&lt;li>&lt;strong>フルスタックAI開発支援（補完〜ファイル生成〜複数ファイル編集）を目指す人&lt;/strong>：&lt;code>codecompanion.nvim&lt;/code>&lt;/li>
&lt;/ul></description></item><item><title>【KVMで自宅インフラ構築】4.DNSサーバーの構築</title><link>http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%894.dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/</link><pubDate>Sat, 05 Apr 2025 00:00:00 +0000</pubDate><guid>http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%894.dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/</guid><description>&lt;p>前回は仮想ネットワーク上にProxyサーバーを構築しました
今回はDNSサーバーを構築し、LANで名前解決ができるようにします&lt;/p>
&lt;ul>
&lt;li>1.構成と準備&lt;/li>
&lt;li>2.Webサーバーの構築&lt;/li>
&lt;li>3.Proxyサーバーの構築&lt;/li>
&lt;li>4.DNSサーバーの構築 &amp;lt;- ここ&lt;/li>
&lt;li>5.Grafanaで監視基盤の構築&lt;/li>
&lt;/ul>
&lt;h2 id="ネットワーク構成のイメージ図">ネットワーク構成のイメージ図
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>完成形&lt;/p>
&lt;ul>
&lt;li>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%894.dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320233329.png"
width="953"
height="406"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%894.dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320233329_hu_1c4bba61b3651171.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%894.dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320233329_hu_f4c2d22ae351df69.png 1024w"
loading="lazy"
alt="index-20250320233329"
class="gallery-image"
data-flex-grow="234"
data-flex-basis="563px"
>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>今回の内容&lt;/p>
&lt;ul>
&lt;li>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%894.dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406233356.png"
width="953"
height="406"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%894.dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406233356_hu_fb161d082c414a9e.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%894.dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406233356_hu_82211d0fabe991a0.png 1024w"
loading="lazy"
alt="index-20250406233356"
class="gallery-image"
data-flex-grow="234"
data-flex-basis="563px"
>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="仮想マシンのデプロイ">仮想マシンのデプロイ
&lt;/h2>&lt;p>まずはDNSサーバー用の仮想マシンを作成していきます。
前回と同じ手順になるので作成や起動の手順は割愛します。
作成した仮想マシンの詳細は以下です&lt;/p>
&lt;ul>
&lt;li>名前: dns-server&lt;/li>
&lt;li>管理ネットワーク側IP: 192.168.122.30&lt;/li>
&lt;li>仮想ネットワーク側IP: 192.168.123.130&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%894.dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406233449.png"
width="3075"
height="1769"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%894.dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406233449_hu_345ee40fabb267c6.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%894.dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406233449_hu_958ec7c057881754.png 1024w"
loading="lazy"
alt="index-20250406233449"
class="gallery-image"
data-flex-grow="173"
data-flex-basis="417px"
>&lt;/p>
&lt;h2 id="dnsサーバの構築">DNSサーバの構築
&lt;/h2>&lt;p>&lt;a class="link" href="https://unbound.docs.nlnetlabs.nl/en/latest/" target="_blank" rel="noopener"
>unbound&lt;/a>を用いてDNSサーバーを構築します。
まずは、デプロイした仮想マシン上で&lt;code>unbound&lt;/code>をインストールします&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ sudo apt install unbound
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>インストールが完了したら、設定を行っていきます。
設定ファイルは&lt;code>/etc/unbound/unbound.conf&lt;/code>にあり、以下のように記載されています。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ cat /etc/unbound/unbound.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Unbound configuration file for Debian.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># See the unbound.conf(5) man page.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># See /usr/share/doc/unbound/examples/unbound.conf for a commented
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># reference config file.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># The following line includes additional configuration files from the
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># /etc/unbound/unbound.conf.d directory.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">include-toplevel: &amp;#34;/etc/unbound/unbound.conf.d/*.conf&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>/etc/unbound/unbound.conf.d/*.conf&lt;/code>のファイルを読み込むように設定されているため、今回は&lt;code>/etc/unbound/unbound.conf.d/unbound.conf&lt;/code>として設定ファイルを作成します&lt;/p>
&lt;p>設定ファイルには、&lt;code>server&lt;/code>句と&lt;code>forward-zone&lt;/code>句の二種類を記述し、以下のように記述することで設定が可能です。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">server:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> interface: DNSサーバーのIP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port: 53
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> access-control: 127.0.0.0/8 allow
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> access-control: LANのCIDR allow
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> use-syslog: yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> log-queries: yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> local-data: &amp;#34;ドメイン. IN A 転送先のIP&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">forward-zone:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &amp;#34;.&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> forward-addr: フォワード先のプライマリDNS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> forward-addr: フォワード先のセカンダリDNS
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>server句&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>interface: Unboundが待ち受けるIPアドレスを指定&lt;/li>
&lt;li>port: 使用するポート番号を指定 (DNSの標準ポートは53)&lt;/li>
&lt;li>access-control: DNSリクエストを許可するクライアントのIP範囲をCIDR形式で指定&lt;/li>
&lt;li>use-syslog: ログ出力先をsyslogにするかどうかを指定。yes にすると /var/log/syslog に出力されます。&lt;/li>
&lt;li>log-queries: DNSクエリをログに記録するかどうかの設定。設定しておくとトラブルシュートや監視に便利です。&lt;/li>
&lt;li>local-data: 特定のホスト名とIPアドレスの対応を定義。(&amp;ldquo;myhost.local. IN A 192.168.1.10&amp;rdquo; とすると、&lt;code>myhost.local&lt;/code>への問い合わせには&lt;code>192.168.1.10&lt;/code>を返します。)
&lt;strong>forward-zone句&lt;/strong>&lt;/li>
&lt;li>name: &lt;code>.&lt;/code> は「すべてのドメイン」を意味し、全てのDNSクエリをこのゾーンの設定に従って処理します。&lt;/li>
&lt;li>forward-addr: クエリを転送する先のDNSサーバーを指定。複数指定可能で、上から順に試行されます。&lt;/li>
&lt;/ul>
&lt;p>その他の設定は以下期に記載されているので参考にしてください&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://unbound.jp/unbound/unbound-conf/" target="_blank" rel="noopener"
>unbound.conf(5) | 日本Unboundユーザー会&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>今回の構成では、以下のように設定します。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">server:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> interface: 192.168.122.30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port: 53
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> access-control: 127.0.0.0/8 allow
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> access-control: 192.168.122.0/24 allow
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> use-syslog: yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> log-queries: yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> local-data: &amp;#34;memos.local. IN A 192.168.123.115&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">forward-zone:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: &amp;#34;.&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> forward-addr: 8.8.8.8
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>設定が完了したらunboundを再起動します&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ sudo systemctl restart unbound.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上でDNSサーバー側の設定は完了です。
ここからは、構築したDNSサーバーを用いて名前解決ができるようにProxyサーバーへ設定を追加します&lt;/p>
&lt;h2 id="proxyサーバーで使用するdnsサーバーの指定">Proxyサーバーで使用するDNSサーバーの指定
&lt;/h2>&lt;p>Proxyサーバーにて、squidで使用するDNSサーバーの設定を行います
設定はすごく簡単で、&lt;code>/etc/squid/squid.conf&lt;/code>に以下のように設定を追加するだけです&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">dns_nameservers DNSサーバーのIP
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>dns_nameservers&lt;/code>の設定について記載されている行があるので、こちらに追記します&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># TAG: dns_nameservers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Use this if you want to specify a list of DNS name servers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># (IP addresses) to use instead of those given in your
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># /etc/resolv.conf file.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># On Windows platforms, if no value is specified here or in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># the /etc/resolv.conf file, the list of DNS name servers are
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># taken from the Windows registry, both static and dynamic DHCP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># configurations are supported.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Example: dns_nameservers 10.0.0.1 192.172.0.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#Default:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Use operating system definitions
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dns_nameservers 192.168.122.30 # ★追記
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>設定が完了したら、下記コマンドでsquidを再起動します。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ sudo systemctl restart squid
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>それでは、構築したDNSサーバーで名前解決ができるか確認していきましょう
設定がうまく通っていれば、無事&lt;code>http://memos.local:5230&lt;/code>でWebサーバーにアクセスできるようになっていると思います&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%894.dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250407002930.png"
width="1621"
height="1209"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%894.dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250407002930_hu_fe71804f60073186.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%894.dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250407002930_hu_e22ba3ee5409a9f7.png 1024w"
loading="lazy"
alt="index-20250407002930"
class="gallery-image"
data-flex-grow="134"
data-flex-basis="321px"
>&lt;/p>
&lt;p>ポート指定が不格好なので、Webサーバーのポートフォワードを変更します&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">sudo&lt;/span> &lt;span class="n">docker&lt;/span> &lt;span class="n">stop&lt;/span> &lt;span class="n">memos&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">memos&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">sudo&lt;/span> &lt;span class="n">docker&lt;/span> &lt;span class="n">rm&lt;/span> &lt;span class="n">memos&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">memos&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">$&lt;/span> &lt;span class="n">sudo&lt;/span> &lt;span class="n">docker&lt;/span> &lt;span class="n">run&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">d&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">init&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="n">memos&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">publish&lt;/span> &lt;span class="mi">80&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">5230&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">volume&lt;/span> &lt;span class="o">~/.&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">opt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">memos&lt;/span> &lt;span class="n">neosmemo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">stable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bba4c0f06042e102eb7ffa0cd620f8425d4deb26d0162f32b68cb33e4c7c0461&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>これで&lt;code>http://memos.local&lt;/code>だけでアクセスができるようになりました&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%894.dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250407003455.png"
width="1621"
height="1209"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%894.dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250407003455_hu_de23a0cf19090911.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%894.dns%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250407003455_hu_cf01a7c6e5750fc.png 1024w"
loading="lazy"
alt="index-20250407003455"
class="gallery-image"
data-flex-grow="134"
data-flex-basis="321px"
>&lt;/p>
&lt;h2 id="補足ログの確認方法">補足:ログの確認方法
&lt;/h2>&lt;h3 id="proxyサーバー-squid">Proxyサーバー (squid)
&lt;/h3>&lt;p>squidのログは&lt;code>access.log&lt;/code>から確認ができます&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">ubuntu&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">ubuntu&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">~$&lt;/span> &lt;span class="n">sudo&lt;/span> &lt;span class="n">tail&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">squid&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">access&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">log&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1743953619.583&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">122.125&lt;/span> &lt;span class="n">TCP_MISS&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">200&lt;/span> &lt;span class="mi">531&lt;/span> &lt;span class="n">POST&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">WorkspaceSettingService&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">GetWorkspaceSetting&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">HIER_DIRECT&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">123.115&lt;/span> &lt;span class="n">application&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">grpc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">web&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">proto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1743953619.609&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">122.125&lt;/span> &lt;span class="n">TCP_MISS&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">200&lt;/span> &lt;span class="mi">605&lt;/span> &lt;span class="n">POST&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">WorkspaceSettingService&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">GetWorkspaceSetting&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">HIER_DIRECT&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">123.115&lt;/span> &lt;span class="n">application&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">grpc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">web&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">proto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1743953619.617&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">122.125&lt;/span> &lt;span class="n">TCP_MISS&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">200&lt;/span> &lt;span class="mi">550&lt;/span> &lt;span class="n">POST&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">AuthService&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">GetAuthStatus&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">HIER_DIRECT&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">123.115&lt;/span> &lt;span class="n">application&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">grpc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">web&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">proto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1743953619.625&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">122.125&lt;/span> &lt;span class="n">TCP_MISS&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">200&lt;/span> &lt;span class="mi">526&lt;/span> &lt;span class="n">POST&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">UserService&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">GetUserSetting&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">HIER_DIRECT&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">123.115&lt;/span> &lt;span class="n">application&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">grpc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">web&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">proto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1743953619.715&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">122.125&lt;/span> &lt;span class="n">TCP_MISS&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">200&lt;/span> &lt;span class="mi">510&lt;/span> &lt;span class="n">POST&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">UserService&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ListShortcuts&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">HIER_DIRECT&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">123.115&lt;/span> &lt;span class="n">application&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">grpc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">web&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">proto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1743953619.715&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">122.125&lt;/span> &lt;span class="n">TCP_MISS&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">200&lt;/span> &lt;span class="mi">510&lt;/span> &lt;span class="n">POST&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">InboxService&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ListInboxes&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">HIER_DIRECT&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">123.115&lt;/span> &lt;span class="n">application&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">grpc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">web&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">proto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1743953619.718&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">122.125&lt;/span> &lt;span class="n">TCP_MISS&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">200&lt;/span> &lt;span class="mi">941&lt;/span> &lt;span class="n">POST&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">MemoService&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ListMemos&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">HIER_DIRECT&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">123.115&lt;/span> &lt;span class="n">application&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">grpc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">web&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">proto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1743953619.747&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">122.125&lt;/span> &lt;span class="n">TCP_MISS&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">200&lt;/span> &lt;span class="mi">25371&lt;/span> &lt;span class="n">GET&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">full&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">logo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">webp&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">HIER_DIRECT&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">123.115&lt;/span> &lt;span class="n">image&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">webp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1743953620.078&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">122.125&lt;/span> &lt;span class="n">TCP_MISS&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">200&lt;/span> &lt;span class="mi">526&lt;/span> &lt;span class="n">POST&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">api&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">v1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">UserService&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">GetUserStats&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">HIER_DIRECT&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">123.115&lt;/span> &lt;span class="n">application&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">grpc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">web&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="n">proto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1743953690.354&lt;/span> &lt;span class="mi">5007&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">122.125&lt;/span> &lt;span class="n">TCP_TUNNEL&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">503&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">CONNECT&lt;/span> &lt;span class="n">push&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">services&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mozilla&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">443&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">HIER_NONE&lt;/span>&lt;span class="o">/-&lt;/span> &lt;span class="o">-&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="dnsサーバー-unbound">DNSサーバー (unbound)
&lt;/h3>&lt;p>unboundのログは&lt;code>/var/log/syslog&lt;/code>に保存されます。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">ubuntu&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">ubuntu&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">~$&lt;/span> &lt;span class="n">sudo&lt;/span> &lt;span class="n">tail&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">syslog&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">grep&lt;/span> &lt;span class="n">unbound&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">2025&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">04&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">06&lt;/span>&lt;span class="n">T15&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">33&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">28.423362&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span> &lt;span class="n">ubuntu&lt;/span> &lt;span class="n">unbound&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">2930&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">info&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">122.83&lt;/span> &lt;span class="n">www&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">google&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">AAAA&lt;/span> &lt;span class="n">IN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">2025&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">04&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">06&lt;/span>&lt;span class="n">T15&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">34&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">45.402548&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span> &lt;span class="n">ubuntu&lt;/span> &lt;span class="n">unbound&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">2930&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">info&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">122.83&lt;/span> &lt;span class="n">push&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">services&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mozilla&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="n">IN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">2025&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">04&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">06&lt;/span>&lt;span class="n">T15&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">34&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">45.403307&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span> &lt;span class="n">ubuntu&lt;/span> &lt;span class="n">unbound&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">2930&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">info&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">122.83&lt;/span> &lt;span class="n">push&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">services&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mozilla&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">AAAA&lt;/span> &lt;span class="n">IN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">2025&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">04&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">06&lt;/span>&lt;span class="n">T15&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">34&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">50.404939&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span> &lt;span class="n">ubuntu&lt;/span> &lt;span class="n">unbound&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">2930&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">info&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">122.83&lt;/span> &lt;span class="n">push&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">services&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mozilla&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="n">IN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">2025&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">04&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">06&lt;/span>&lt;span class="n">T15&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">34&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">50.406916&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span> &lt;span class="n">ubuntu&lt;/span> &lt;span class="n">unbound&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">2930&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">info&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">122.83&lt;/span> &lt;span class="n">push&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">services&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mozilla&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">AAAA&lt;/span> &lt;span class="n">IN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">2025&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">04&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">06&lt;/span>&lt;span class="n">T15&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">34&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">50.407588&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span> &lt;span class="n">ubuntu&lt;/span> &lt;span class="n">unbound&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">2930&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">info&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">122.83&lt;/span> &lt;span class="n">push&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">services&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mozilla&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="n">IN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">2025&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">04&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">06&lt;/span>&lt;span class="n">T15&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">34&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">50.408005&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span> &lt;span class="n">ubuntu&lt;/span> &lt;span class="n">unbound&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">2930&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">info&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">122.83&lt;/span> &lt;span class="n">push&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">services&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mozilla&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">AAAA&lt;/span> &lt;span class="n">IN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">2025&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">04&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">06&lt;/span>&lt;span class="n">T15&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">34&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">50.408470&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span> &lt;span class="n">ubuntu&lt;/span> &lt;span class="n">unbound&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">2930&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">info&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">122.83&lt;/span> &lt;span class="n">push&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">services&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mozilla&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="n">IN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">2025&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">04&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">06&lt;/span>&lt;span class="n">T15&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">34&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mf">50.408629&lt;/span>&lt;span class="o">+&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span> &lt;span class="n">ubuntu&lt;/span> &lt;span class="n">unbound&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">2930&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">info&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">122.83&lt;/span> &lt;span class="n">push&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">services&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mozilla&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">AAAA&lt;/span> &lt;span class="n">IN&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>【KVMで自宅インフラ構築】3.Proxyサーバーの構築</title><link>http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/</link><pubDate>Fri, 14 Mar 2025 00:00:00 +0000</pubDate><guid>http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/</guid><description>&lt;p>前回は仮想ネットワーク上にWebサーバーを構築しました
今回はProxyサーバーを構築し、管理ネットワークからWebサーバーを閲覧できるようにします&lt;/p>
&lt;ul>
&lt;li>1.構成と準備&lt;/li>
&lt;li>2.Webサーバーの構築&lt;/li>
&lt;li>3.Proxyサーバーの構築 &amp;lt;- ここ&lt;/li>
&lt;li>4.DNSサーバーの構築&lt;/li>
&lt;li>5.Grafanaで監視基盤の構築&lt;/li>
&lt;/ul>
&lt;h2 id="ネットワーク構成のイメージ図">ネットワーク構成のイメージ図
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>完成形&lt;/p>
&lt;ul>
&lt;li>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320233329.png"
width="953"
height="406"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320233329_hu_1c4bba61b3651171.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320233329_hu_f4c2d22ae351df69.png 1024w"
loading="lazy"
alt="index-20250320233329"
class="gallery-image"
data-flex-grow="234"
data-flex-basis="563px"
>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>今回の内容&lt;/p>
&lt;ul>
&lt;li>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406233244.png"
width="954"
height="404"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406233244_hu_f77a88489e9cb010.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406233244_hu_67396b06394b9bd2.png 1024w"
loading="lazy"
alt="index-20250406233244"
class="gallery-image"
data-flex-grow="236"
data-flex-basis="566px"
>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="仮想マシンのデプロイ">仮想マシンのデプロイ
&lt;/h2>&lt;p>まずはProxyサーバー用の仮想マシンを作成していきます。
前回と同じ手順になるので作成や起動の手順は割愛します。(proxy-serverの名前で仮想マシンを作成しました)
&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320234023.png"
width="3466"
height="2017"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320234023_hu_dcbbd92d79be2785.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320234023_hu_2e6ddbee540d9cd3.png 1024w"
loading="lazy"
alt="index-20250320234023"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="412px"
>&lt;/p>
&lt;p>つづいて、仮想マシンの仮想ネットワーク設定を行っていきます。
ProxyサーバーはWebサーバーを閲覧するPCが利用する&lt;code>管理ネットワーク&lt;/code>と、Webサーバーが接続される&lt;code>仮想ネットワーク&lt;/code>の両方に足を出している必要があります。
&lt;code>仮想ネットワーク&lt;/code>にはクローン時点で既に接続されているため、新しくネットワークインターフェースを作成し、&lt;code>管理ネットワーク&lt;/code>に接続します。
まずは仮想マシンの&lt;code>ネットワークインターフェース&lt;/code>から&lt;code>ネットワークインターフェースの追加&lt;/code>をクリックします
&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320234341.png"
width="3466"
height="2017"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320234341_hu_73bb6a5b02418011.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320234341_hu_adadae0788ce9ded.png 1024w"
loading="lazy"
alt="index-20250320234341"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="412px"
>&lt;/p>
&lt;p>下記設定で追加します (仮想マシンがパワーオフの状態で実施する)&lt;/p>
&lt;ul>
&lt;li>インターフェース形式: Direct attachment&lt;/li>
&lt;li>ソース: enp1s0 (KVMホストの物理NICを指定します)&lt;/li>
&lt;li>モデル: virtio&lt;/li>
&lt;li>MACアドレス: 自動生成&lt;/li>
&lt;li>永続: ☑常に割り当てる
&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320234636.png"
width="3466"
height="2017"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320234636_hu_8cb9f6b1e6c0a9b1.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320234636_hu_2b3cad9fa1730a98.png 1024w"
loading="lazy"
alt="index-20250320234636"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="412px"
>&lt;/li>
&lt;/ul>
&lt;p>追加が完了すると、Cockpitの画面で追加されていることが確認できます&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320235327.png"
width="3466"
height="2017"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320235327_hu_3992fef3f67ed739.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320235327_hu_eb3ee975af591f8f.png 1024w"
loading="lazy"
alt="index-20250320235327"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="412px"
>&lt;/p>
&lt;p>インターフェースが追加できたので、仮想マシンの方でもネットワークの設定をしてあげます&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ sudo cat /etc/netplan/50-cloud-init.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># This file is generated from information provided by the datasource. Changes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># to it will not persist across an instance reboot. To disable cloud-init&amp;#39;s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># network configuration capabilities, write a file
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># network: {config: disabled}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ethernets:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> enp0s3:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp4: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp-identifier: mac
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> enp0s7:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp4: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ sudo netplan apply
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>これで&lt;code>管理ネットワーク&lt;/code>と&lt;code>仮想ネットワーク&lt;/code>の両方に接続された仮想マシンが作成できました&lt;/p>
&lt;ul>
&lt;li>管理ネットワーク側IP: 192.168.122.83&lt;/li>
&lt;li>仮想ネットワーク側IP: 192.168.123.120&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ ip a show enp0s7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3: enp0s7: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 52:54:00:87:91:ff brd ff:ff:ff:ff:ff:ff
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet 192.168.122.83/24 metric 100 brd 192.168.122.255 scope global dynamic enp0s7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft 3465sec preferred_lft 3465sec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet6 fe80::5054:ff:fe87:91ff/64 scope link
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ip a show enp0s3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2: enp0s3: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> link/ether 52:54:00:54:18:43 brd ff:ff:ff:ff:ff:ff
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet 192.168.123.120/24 metric 100 brd 192.168.123.255 scope global dynamic enp0s3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft 3468sec preferred_lft 3468sec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> inet6 fe80::5054:ff:fe54:1843/64 scope link
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> valid_lft forever preferred_lft forever
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="proxyサーバの構築">Proxyサーバの構築
&lt;/h2>&lt;p>squidを用いてProxyサーバーを構築します。
まずは、デプロイした仮想マシン上で&lt;code>squid&lt;/code>をインストールします&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ sudo apt install squid
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>インストールが完了したら、設定を行っていきます。
設定ファイルは&lt;code>/etc/squid/squid.conf&lt;/code>にあります。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ sudo vi /etc/squid/squid.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ファイルの&lt;code>1400行目&lt;/code>あたりに下記のような記載があるので、&lt;code>Allow_Local_Network&lt;/code>の設定を追記します&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># Example rule allowing access from your local networks.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Adapt to list your (internal) IP networks from where browsing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># should be allowed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl localnet src 0.0.0.1-0.255.255.255 # RFC 1122 &amp;#34;this&amp;#34; network (LAN)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl localnet src 10.0.0.0/8 # RFC 1918 local private network (LAN)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl localnet src 100.64.0.0/10 # RFC 6598 shared address space (CGN)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl localnet src 169.254.0.0/16 # RFC 3927 link-local (directly plugged) machines
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl localnet src 172.16.0.0/12 # RFC 1918 local private network (LAN)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl localnet src 192.168.0.0/16 # RFC 1918 local private network (LAN)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl localnet src fc00::/7 # RFC 4193 local private network range
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl localnet src fe80::/10 # RFC 4291 link-local (directly plugged) machines
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl Allow_Local_Network src 192.168.123.0/24 # &amp;lt;- ★ この行を追記
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>さらに、&lt;code>1601行目&lt;/code>あたりの下記コメントがある行に二行追記します&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zed" data-lang="zed">&lt;span class="line">&lt;span class="cl">&lt;span class="err">#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">For&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">example&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">allow&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">access&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">from&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">your&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">networks&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">you&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">may&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">uncomment&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">the&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">following&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rule&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nn">and/&lt;/span>&lt;span class="n">or&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">rules&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">that&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">match&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">your&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">definition&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">of&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="n">local&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="err">#&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">http_access&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">allow&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">localnet&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">http_access&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">allow&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">localnet&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">http_access&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">allow&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Allow_Local_Network&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上記設定が完了したら、下記コマンドでsquidを再起動します。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ sudo systemctl restart squid
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="proxyサーバーを経由したwebサーバーへのアクセス">Proxyサーバーを経由したWebサーバーへのアクセス
&lt;/h2>&lt;p>Proxyサーバーの構築が完了したので、これを利用してWebサーバーへのアクセスを行います。
そのためには、WebサーバーへアクセスするクライアントにてProxyサーバーを利用する設定を行う必要があります。
今回はUbuntuサーバーを用いるため、以下の手順でProxyサーバーの設定を行います&lt;/p>
&lt;ul>
&lt;li>「Settings」→「Network」→「Proxy」
&lt;ul>
&lt;li>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406170916.png"
width="2166"
height="1622"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406170916_hu_11231b669c127677.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406170916_hu_6d4e6c5054becde7.png 1024w"
loading="lazy"
alt="index-20250406170916"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>「Network Proxy」を有効にし、以下設定を入力する
&lt;ul>
&lt;li>Configuration: &lt;code>Manual&lt;/code>&lt;/li>
&lt;li>HTTP Proxy:
&lt;ul>
&lt;li>URL: Proxyサーバーの管理用ネットワーク側のIP (&lt;code>192.168.122.83&lt;/code>)&lt;/li>
&lt;li>Port: ProxyサーバーのPort (&lt;code>3128&lt;/code>)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>HTTPS Proxy:
&lt;ul>
&lt;li>URL: Proxyサーバーの管理用ネットワーク側のIP (&lt;code>192.168.122.83&lt;/code>)&lt;/li>
&lt;li>Port: ProxyサーバーのPort (&lt;code>3128&lt;/code>)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406171134.png"
width="2166"
height="1622"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406171134_hu_f094c79fd8746789.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406171134_hu_29a2da699791a251.png 1024w"
loading="lazy"
alt="index-20250406171134"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>上記設定が完了したら、ブラウザでWebサーバーにアクセスができるようになります！(&lt;code>http://192.168.123.15:5230&lt;/code>)&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406174344.png"
width="2166"
height="1622"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406174344_hu_aded65531fb2b261.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406174344_hu_e444c9c41be0f28f.png 1024w"
loading="lazy"
alt="index-20250406174344"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
>&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406174628.png"
width="2166"
height="1622"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406174628_hu_406a6640e7b7c27a.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%893.proxy%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250406174628_hu_7b6365fad1c14a83.png 1024w"
loading="lazy"
alt="index-20250406174628"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="320px"
>&lt;/p>
&lt;p>以上でsquidを用いたProxyサーバーの構築ができました。
次は&lt;a class="link" href="" >4.DNSサーバーの構築&lt;/a>でLAでN名前解決ができるようにします&lt;/p></description></item><item><title>【KVMで自宅インフラ構築】2.Webサーバーの構築</title><link>http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/</link><pubDate>Wed, 12 Mar 2025 00:00:00 +0000</pubDate><guid>http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/</guid><description>&lt;p>前回はこれから作成する環境の構築の紹介とその準備を行いました。
今回はOSSを用いて簡単なWebサーバーを構築します&lt;/p>
&lt;ul>
&lt;li>1.構成と準備&lt;/li>
&lt;li>2.Webサーバーの構築 &amp;lt;-ここ&lt;/li>
&lt;li>3.Proxyサーバーの構築&lt;/li>
&lt;li>4.DNSサーバーの構築&lt;/li>
&lt;li>5.Grafanaで監視基盤の構築&lt;/li>
&lt;/ul>
&lt;h2 id="ネットワーク構成のイメージ図">ネットワーク構成のイメージ図
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>完成形&lt;/p>
&lt;ul>
&lt;li>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320233023.png"
width="953"
height="406"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320233023_hu_1c4bba61b3651171.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320233023_hu_f4c2d22ae351df69.png 1024w"
loading="lazy"
alt="index-20250320233023"
class="gallery-image"
data-flex-grow="234"
data-flex-basis="563px"
>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>今回の内容&lt;/p>
&lt;ul>
&lt;li>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320233222.png"
width="953"
height="404"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320233222_hu_2deb166db1f04c60.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320233222_hu_b47eb2cee31f4e95.png 1024w"
loading="lazy"
alt="index-20250320233222"
class="gallery-image"
data-flex-grow="235"
data-flex-basis="566px"
>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="webサーバーに利用するoss選び">Webサーバーに利用するOSS選び
&lt;/h2>&lt;p>このシリーズの目的としてはWebサーバーにこだわる必要はないのですが。。
せっかくなのでおすすめのOSSをいくつか紹介します&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://usememos.com/" target="_blank" rel="noopener"
>memos&lt;/a>
&lt;ul>
&lt;li>シンプルで軽量な自己ホスト型のメモ管理アプリ&lt;/li>
&lt;li>マークダウンをサポート&lt;/li>
&lt;li>Slackのような使い心地のメモ帳&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a class="link" href="https://gitea.io/" target="_blank" rel="noopener"
>gitea&lt;/a>
&lt;ul>
&lt;li>軽量な自己ホスト型Gitサービス&lt;/li>
&lt;li>GitHubのようなリポジトリ管理をローカル環境で実現できる&lt;/li>
&lt;li>低リソースで動作するのが特徴&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a class="link" href="https://mattermost.com/" target="_blank" rel="noopener"
>Mattermost&lt;/a>
&lt;ul>
&lt;li>オープンソースのチーム向けチャットプラットフォーム&lt;/li>
&lt;li>Slackの代替として利用でき、高いカスタマイズ性を持つ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a class="link" href="https://nextcloud.com/" target="_blank" rel="noopener"
>Nextcloud&lt;/a>
&lt;ul>
&lt;li>自己ホスト型のクラウドストレージサービス&lt;/li>
&lt;li>DropboxやGoogle Driveの代替として利用できる&lt;/li>
&lt;li>ファイル共有やコラボレーション機能が充実&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a class="link" href="https://immich.app/" target="_blank" rel="noopener"
>Immich&lt;/a>
&lt;ul>
&lt;li>オープンソースの自己ホスト型写真・動画管理システム&lt;/li>
&lt;li>Google Photosの代替として利用できる&lt;/li>
&lt;li>AIによる画像認識や自動バックアップ機能をもつ&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>今回は&lt;code>memos&lt;/code>を使ってWebサーバーを構築します&lt;/p>
&lt;h2 id="仮想マシンのデプロイ">仮想マシンのデプロイ
&lt;/h2>&lt;p>それではWebサーバー用の仮想マシンを作成していきます。
まずは&lt;code>仮想マシンの準備&lt;/code>で作成した仮想マシンをクローンして新しい仮想マシンを作成します&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320225149.png"
width="3454"
height="2024"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320225149_hu_f67782767d4f0f96.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320225149_hu_13c5202bdee9dd33.png 1024w"
loading="lazy"
alt="index-20250320225149"
class="gallery-image"
data-flex-grow="170"
data-flex-basis="409px"
>&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320225209.png"
width="3454"
height="2024"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320225209_hu_854332f7cb9ac918.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320225209_hu_83c744800647fd6d.png 1024w"
loading="lazy"
alt="index-20250320225209"
class="gallery-image"
data-flex-grow="170"
data-flex-basis="409px"
>&lt;/p>
&lt;p>作成が完了したら、仮想マシンが仮想ネットワーク&lt;code>default&lt;/code>に接続されていることを確認します&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320231703.png"
width="3466"
height="2017"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320231703_hu_7cdcf17b4358b142.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320231703_hu_8e4083b14f9a26de.png 1024w"
loading="lazy"
alt="index-20250320231703"
class="gallery-image"
data-flex-grow="171"
data-flex-basis="412px"
>&lt;/p>
&lt;p>ネットワークの確認ができたら&lt;code>実行&lt;/code>をクリックして仮想マシンを起動します&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320225254.png"
width="3454"
height="2024"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320225254_hu_c4e9371896b6c76.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320225254_hu_2b881d8de05d703e.png 1024w"
loading="lazy"
alt="index-20250320225254"
class="gallery-image"
data-flex-grow="170"
data-flex-basis="409px"
>&lt;/p>
&lt;p>起動が完了したら仮想マシンの画面からコンソールに入ることができます
(SSHでログインしたい場合は &lt;code>KVMホスト -&amp;gt; 作成した仮想マシン&lt;/code>で接続してください)&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320225349.png"
width="3454"
height="2024"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320225349_hu_53fbed3827297f06.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%892.web%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%A7%8B%E7%AF%89/uploads/index-20250320225349_hu_799c51b62a8d3829.png 1024w"
loading="lazy"
alt="index-20250320225349"
class="gallery-image"
data-flex-grow="170"
data-flex-basis="409px"
>&lt;/p>
&lt;h2 id="webサーバーの起動">Webサーバーの起動
&lt;/h2>&lt;p>デプロイは&lt;a class="link" href="https://www.usememos.com/docs/install/container-install" target="_blank" rel="noopener"
>公式ドキュメント&lt;/a>に沿ってDockerを使って行います。
下記dockerコマンドを実行するだけで完了です&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">sudo&lt;/span> &lt;span class="n">docker&lt;/span> &lt;span class="n">run&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">d&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">init&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="n">memos&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">publish&lt;/span> &lt;span class="mi">5230&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">5230&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">--&lt;/span>&lt;span class="n">volume&lt;/span> &lt;span class="o">~/.&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">opt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">memos&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">neosmemo&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">memos&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">stable&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>まだブラウザから確認ができないため、curlコマンドでWebサーバーが動作しているか確認します&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ curl -I 0.0.0.0:5230
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">HTTP/1.1 200 OK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Accept-Ranges: bytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Content-Length: 2784
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Content-Type: text/html; charset=utf-8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Date: Thu, 20 Mar 2025 14:20:13 GMT~$ curl -I 0.0.0.0:5230
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>確認できました。これでWebサーバーの準備は完了です！
次は&lt;a class="link" href="" >3.Proxyサーバーの構築&lt;/a>でProxy経由でWebサーバーにアクセスできるようにします&lt;/p></description></item><item><title>【KVMで自宅インフラ構築】1.構成と準備</title><link>http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%891.%E6%A7%8B%E6%88%90%E3%81%A8%E6%BA%96%E5%82%99/</link><pubDate>Mon, 10 Mar 2025 00:00:00 +0000</pubDate><guid>http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%891.%E6%A7%8B%E6%88%90%E3%81%A8%E6%BA%96%E5%82%99/</guid><description>&lt;p>自宅でKVMを使ったシンプルなインフラ環境を構築します
Proxyサーバーを介してWebサーバーへ接続し、さらにDNSで名前解決をできるようにします
最終的にgrafanaで各サーバーの監視設定を行うところまでをやろうと思います&lt;/p>
&lt;h2 id="構築の流れ">構築の流れ
&lt;/h2>&lt;ul>
&lt;li>1.構成と準備 &amp;lt;-ここ&lt;/li>
&lt;li>2.Webサーバーの構築&lt;/li>
&lt;li>3.Proxyサーバーの構築&lt;/li>
&lt;li>4.DNSサーバーの構築&lt;/li>
&lt;li>5.Grafanaで監視基盤の構築&lt;/li>
&lt;/ul>
&lt;h2 id="ネットワーク構成のイメージ図">ネットワーク構成のイメージ図
&lt;/h2>&lt;p>扱うネットワークは以下の２つです&lt;/p>
&lt;ul>
&lt;li>管理用ネットワーク: 192.168.122.0/24
&lt;ul>
&lt;li>Webサーバーを利用するクライアントが接続されているネットワーク&lt;/li>
&lt;li>このネットワークからProxyを介してWebサーバーにアクセスします&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>KVMの仮想ネットワーク: 192.168.123.0/24
&lt;ul>
&lt;li>Webサーバーが接続されるローカルネットワーク&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%891.%E6%A7%8B%E6%88%90%E3%81%A8%E6%BA%96%E5%82%99/uploads/index-20250320233029.png"
width="953"
height="406"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%891.%E6%A7%8B%E6%88%90%E3%81%A8%E6%BA%96%E5%82%99/uploads/index-20250320233029_hu_1c4bba61b3651171.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%891.%E6%A7%8B%E6%88%90%E3%81%A8%E6%BA%96%E5%82%99/uploads/index-20250320233029_hu_f4c2d22ae351df69.png 1024w"
loading="lazy"
alt="index-20250320233029"
class="gallery-image"
data-flex-grow="234"
data-flex-basis="563px"
>&lt;/p>
&lt;h2 id="利用するソフトウェア">利用するソフトウェア
&lt;/h2>&lt;p>仮想マシンの作成やネットワークの設定には&lt;a class="link" href="https://www.redhat.com/en/blog/manage-virtual-machines-cockpit" target="_blank" rel="noopener"
>Cockpit&lt;/a>を使用します&lt;/p>
&lt;h2 id="kvmホストの構成">KVMホストの構成
&lt;/h2>&lt;p>本シリーズ用に物理のホストを用意できなかったため、Nested KVM構成で行います&lt;/p>
&lt;ul>
&lt;li>CPU: 4vCPU&lt;/li>
&lt;li>メモリ: 16GB&lt;/li>
&lt;li>ストレージ: 100GB&lt;/li>
&lt;li>OS: Ubuntu 24.04&lt;/li>
&lt;/ul>
&lt;h2 id="ネットワーク構成">ネットワーク構成
&lt;/h2>&lt;p>仮想ネットワークには、デフォルトで作成される&lt;code>default&lt;/code>を使用します&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ virsh net-list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name State Autostart Persistent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default active yes yes
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>この仮想ネットワークの詳細は&lt;code>net-dumpxml&lt;/code>で確認することができ、以下の通りです&lt;/p>
&lt;ul>
&lt;li>NATモード で動作し、仮想マシンが外部ネットワークへアクセス可能&lt;/li>
&lt;li>仮想ブリッジvirbr0を使用して通信を管理&lt;/li>
&lt;li>ホストのIP (192.168.123.1) がゲートウェイとして機能&lt;/li>
&lt;li>DHCP により、 192.168.123.2 〜 192.168.123.254 の範囲でIPアドレスを自動割り当て&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ virsh net-dumpxml default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;network&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;name&amp;gt;default&amp;lt;/name&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;uuid&amp;gt;61c20183-757b-402f-a92e-677072b910d0&amp;lt;/uuid&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;forward mode=&amp;#39;nat&amp;#39;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;nat&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;port start=&amp;#39;1024&amp;#39; end=&amp;#39;65535&amp;#39;/&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/nat&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/forward&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;bridge name=&amp;#39;virbr0&amp;#39; stp=&amp;#39;on&amp;#39; delay=&amp;#39;0&amp;#39;/&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;mac address=&amp;#39;52:54:00:a3:31:ff&amp;#39;/&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;ip address=&amp;#39;192.168.123.1&amp;#39; netmask=&amp;#39;255.255.255.0&amp;#39;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;dhcp&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;range start=&amp;#39;192.168.123.2&amp;#39; end=&amp;#39;192.168.123.254&amp;#39;/&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/dhcp&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/ip&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/network&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="仮想マシンの準備">仮想マシンの準備
&lt;/h2>&lt;p>今回は合計で4つの仮想マシンを構築します。
都度一から作成するのは面倒なのでテンプレートを作成し、それをクローンする形で使用します
スペックは以下の通りです。&lt;/p>
&lt;ul>
&lt;li>CPU: 2vCPU&lt;/li>
&lt;li>メモリ: 4GB&lt;/li>
&lt;li>ストレージ: 20GB&lt;/li>
&lt;li>OS: Ubuntu 24.04&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%891.%E6%A7%8B%E6%88%90%E3%81%A8%E6%BA%96%E5%82%99/uploads/index-20250320231522.png"
width="3454"
height="2024"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%891.%E6%A7%8B%E6%88%90%E3%81%A8%E6%BA%96%E5%82%99/uploads/index-20250320231522_hu_805fe2b457cb5a1d.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%891.%E6%A7%8B%E6%88%90%E3%81%A8%E6%BA%96%E5%82%99/uploads/index-20250320231522_hu_37965c2a97ef37c2.png 1024w"
loading="lazy"
alt="index-20250320231522"
class="gallery-image"
data-flex-grow="170"
data-flex-basis="409px"
>
&lt;img src="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%891.%E6%A7%8B%E6%88%90%E3%81%A8%E6%BA%96%E5%82%99/uploads/index-20250320231534.png"
width="3454"
height="2024"
srcset="http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%891.%E6%A7%8B%E6%88%90%E3%81%A8%E6%BA%96%E5%82%99/uploads/index-20250320231534_hu_40396ece34876596.png 480w, http://192.168.122.81/p/kvm%E3%81%A7%E8%87%AA%E5%AE%85%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9%E6%A7%8B%E7%AF%891.%E6%A7%8B%E6%88%90%E3%81%A8%E6%BA%96%E5%82%99/uploads/index-20250320231534_hu_736b8bf654f84970.png 1024w"
loading="lazy"
alt="index-20250320231534"
class="gallery-image"
data-flex-grow="170"
data-flex-basis="409px"
>&lt;/p>
&lt;p>また、クローンした仮想マシンにDHCPから異なるIPが割り当てるよう、以下設定を追記しておきます (&lt;a class="link" href="https://qiita.com/sandopan65/items/75ca7e6563e86a7dfd8c" target="_blank" rel="noopener"
>参考&lt;/a>)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">network:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ethernets:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> enp1s0:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp4: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp-identifier: mac # この行を追記
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version: 2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>これで準備が整いました。次回は&lt;a class="link" href="" >2.Webサーバーの構築&lt;/a>を進めていきます&lt;/p></description></item><item><title>【KVMの仮想化入門⑤】仮想ネットワークの種類と接続方法</title><link>http://192.168.122.81/post_archived/kvm-network1/</link><pubDate>Wed, 18 Dec 2024 00:00:00 +0000</pubDate><guid>http://192.168.122.81/post_archived/kvm-network1/</guid><description>&lt;p>前回はcockpitで仮想マシンを作成する方法を紹介しました。&lt;/p>
&lt;h2 id="設定概要">設定概要
&lt;/h2>&lt;h3 id="vmのネットワークの種類">VMのネットワークの種類
&lt;/h3>&lt;ul>
&lt;li>&lt;/li>
&lt;/ul>
&lt;h2 id="仮想ネットワーク">仮想ネットワーク
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ubuntu@kvm001:~$ virsh net-dumpxml default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;network&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;name&amp;gt;default&amp;lt;/name&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;uuid&amp;gt;61c20183-757b-402f-a92e-677072b910d0&amp;lt;/uuid&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;forward mode=&amp;#39;nat&amp;#39;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;nat&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;port start=&amp;#39;1024&amp;#39; end=&amp;#39;65535&amp;#39;/&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/nat&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/forward&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;bridge name=&amp;#39;virbr0&amp;#39; stp=&amp;#39;on&amp;#39; delay=&amp;#39;0&amp;#39;/&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;mac address=&amp;#39;52:54:00:a3:31:ff&amp;#39;/&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;ip address=&amp;#39;192.168.123.1&amp;#39; netmask=&amp;#39;255.255.255.0&amp;#39;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;dhcp&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;range start=&amp;#39;192.168.123.2&amp;#39; end=&amp;#39;192.168.123.254&amp;#39;/&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/dhcp&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/ip&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/network&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="仮想nic">仮想NIC
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> &amp;lt;interface type=&amp;#39;network&amp;#39;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;mac address=&amp;#39;52:54:00:77:59:98&amp;#39;/&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;source network=&amp;#39;default&amp;#39;/&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;model type=&amp;#39;rtl8139&amp;#39;/&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;address type=&amp;#39;pci&amp;#39; domain=&amp;#39;0x0000&amp;#39; bus=&amp;#39;0x00&amp;#39; slot=&amp;#39;0x03&amp;#39; function=&amp;#39;0x0&amp;#39;/&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/interface&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>【KVMの仮想化入門④】cockpitでVMを構築してみる</title><link>http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/</link><pubDate>Tue, 17 Dec 2024 00:00:00 +0000</pubDate><guid>http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/</guid><description>&lt;p>前回はcockpitでWebブラウザからVMを確認するところまでを実施しました。今回はcockpitからVMを構築してみようと思います。&lt;/p>
&lt;h2 id="ネットワークの作成">ネットワークの作成
&lt;/h2>&lt;p>前回作成したubuntu001は、デフォルトで作成されていたネットワーク(&lt;code>default&lt;/code>)にアタッチしました。&lt;br>
今回は新しくネットワークを作成し、そこにアタッチする形にしようと思います&lt;/p>
&lt;p>cockpitの仮想マシンタブから&lt;code>1個のネットワーク&lt;/code>をクリックします&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_vms.png"
width="3840"
height="2024"
srcset="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_vms_hu_c71fd4c51a1e7824.png 480w, http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_vms_hu_44c3cea3e7c14947.png 1024w"
loading="lazy"
alt="cockpit_vms"
class="gallery-image"
data-flex-grow="189"
data-flex-basis="455px"
>&lt;/p>
&lt;p>上の画像のようにdefaultネットワークの情報が確認できました&lt;br>
&lt;code>仮想ネットワークの作成&lt;/code>よりネットワークを作成します&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_nws1.png"
width="3840"
height="2024"
srcset="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_nws1_hu_f35b83a5bd6716ba.png 480w, http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_nws1_hu_92999560b16ceeb4.png 1024w"
loading="lazy"
alt="cockpit_nws1"
class="gallery-image"
data-flex-grow="189"
data-flex-basis="455px"
>&lt;/p>
&lt;p>設定は以下を入力し、作成ボタンをクリックします&lt;/p>
&lt;ul>
&lt;li>名前: test_network001&lt;/li>
&lt;li>フォワードモード: NAT (NATを使用してグローバルに出ることができる設定)&lt;/li>
&lt;li>デバイス: virbr0 (virbr0を設定しておくと新規でブリッジ&lt;code>virbr1&lt;/code>が作成され、利用されます)&lt;/li>
&lt;li>IP設定: IPv4のみ
&lt;ul>
&lt;li>IPv4 アドレス: 192.168.100.1&lt;/li>
&lt;li>マスクまたはプレフィックス長: 24&lt;/li>
&lt;li>DHCPの範囲を設定します: ☑&lt;/li>
&lt;li>開始: 192.168.100.2 / 末尾: 192.168.100.254&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_newnw.png"
width="1940"
height="1491"
srcset="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_newnw_hu_5c51fd999e4bafb3.png 480w, http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_newnw_hu_8a7789df27683094.png 1024w"
loading="lazy"
alt="cockpit_newnw"
class="gallery-image"
data-flex-grow="130"
data-flex-basis="312px"
>&lt;/p>
&lt;p>新しく&lt;code>test_network001&lt;/code>のネットワークが作成されたことが確認できます&lt;br>
また、デバイスに&lt;code>virbr0&lt;/code>を指定して作成しましたが、自動的に新しいブリッジ&lt;code>virbt1&lt;/code>が作成され、デバイスに指定されていることが確認できます&lt;br>
&lt;code>有効化&lt;/code>をクリックすることで、このネットワークが利用可能になります。ホスト起動時に自動的に起動されるよう&lt;code>自動起動&lt;/code>を有効にしておきましょう&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_newnw_check.png"
width="3840"
height="2016"
srcset="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_newnw_check_hu_58bd8fc9b5771678.png 480w, http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_newnw_check_hu_d60f0e8847a807c2.png 1024w"
loading="lazy"
alt="cockpit_newnw_check"
class="gallery-image"
data-flex-grow="190"
data-flex-basis="457px"
>&lt;/p>
&lt;h2 id="vmの構築">VMの構築
&lt;/h2>&lt;p>それではいよいよ仮想マシンの作成をしてみようと思います&lt;/p>
&lt;p>cockpitの仮想マシンから、仮想マシンの作成をクリックします&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_vms2.png"
width="3840"
height="2024"
srcset="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_vms2_hu_4df0ba850664d1f6.png 480w, http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_vms2_hu_e02d6c0a3012d62f.png 1024w"
loading="lazy"
alt="cockpit_vms2"
class="gallery-image"
data-flex-grow="189"
data-flex-basis="455px"
>&lt;/p>
&lt;p>表示される作成画面に、以下情報を入力し、&lt;code>作成して実行する&lt;/code>をクリックしましょう&lt;/p>
&lt;ul>
&lt;li>接続: System&lt;/li>
&lt;li>インストールタイプ: ローカルインストールメディア&lt;/li>
&lt;li>インストールソース: /iso/ubuntu-24.04.1-live-server-amd64.iso&lt;/li>
&lt;li>オペレーティングシステム: Ubuntu 24.04 LTS (Noble Numbat)&lt;/li>
&lt;li>ストレージ: qcow2ボリュームの新規作成&lt;/li>
&lt;li>ストレージの制限: 20GB&lt;/li>
&lt;li>メモリ: 4GB&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_newvm.png"
width="3840"
height="2024"
srcset="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_newvm_hu_277a0c7155182cce.png 480w, http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_newvm_hu_9cfe697a8fba390c.png 1024w"
loading="lazy"
alt="cockpit_newvm"
class="gallery-image"
data-flex-grow="189"
data-flex-basis="455px"
>&lt;/p>
&lt;p>作成してまもなく仮想マシンの一覧に追加され、状態が &lt;code>Runnningになっていることが確認できます&lt;/code>&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_vms3.png"
width="3840"
height="2024"
srcset="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_vms3_hu_f49d50e955a0728e.png 480w, http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_vms3_hu_602f6328022bcb1c.png 1024w"
loading="lazy"
alt="cockpit_vms3"
class="gallery-image"
data-flex-grow="189"
data-flex-basis="455px"
>&lt;/p>
&lt;p>作成したubuntu002を開いてみると、VMの情報と共に画面右側のコンソールではUbuntuのインストールが始まっていることが確認できます&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_newvm2.png"
width="3840"
height="2024"
srcset="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_newvm2_hu_90bf0dce14ddd81b.png 480w, http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_newvm2_hu_113aed4e27233d2a.png 1024w"
loading="lazy"
alt="cockpit_newvm2"
class="gallery-image"
data-flex-grow="189"
data-flex-basis="455px"
>&lt;/p>
&lt;p>ディスクとネットワークの設定は以下図のようになっています。&lt;br>
ディスクはメインで使用するdiskと、OSをインストールするためのcdromがアタッチされています&lt;br>
ネットワークをみると&lt;code>default&lt;/code>のネットワークがアタッチされていることがわかります。新しく作成したネットワークにしたいので、変更をしてみましょう&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_newvm3.png"
width="3305"
height="898"
srcset="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_newvm3_hu_99064d9a808b1f93.png 480w, http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_newvm3_hu_6bd1ce7ae74e2ac0.png 1024w"
loading="lazy"
alt="cockpit_newvm3"
class="gallery-image"
data-flex-grow="368"
data-flex-basis="883px"
>&lt;/p>
&lt;p>ネットワークの編集ボタンをクリックし、開かれる画面から&lt;code>ソース&lt;/code>を&lt;code>test_network001&lt;/code>に変更します&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_change_nw.png"
width="1926"
height="943"
srcset="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_change_nw_hu_4c0bc9056da2e23.png 480w, http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_change_nw_hu_c71f5307fb286b48.png 1024w"
loading="lazy"
alt="cockpit_change_nw"
class="gallery-image"
data-flex-grow="204"
data-flex-basis="490px"
>&lt;/p>
&lt;p>これにより、インターフェースのソースとIPが変更されていることが確認できます&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_change_nw2.png"
width="3329"
height="454"
srcset="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_change_nw2_hu_96167cce5b7552a1.png 480w, http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_change_nw2_hu_76d922a1dec7e4da.png 1024w"
loading="lazy"
alt="cockpit_change_nw2"
class="gallery-image"
data-flex-grow="733"
data-flex-basis="1759px"
>&lt;/p>
&lt;p>以上がcockpitからのVM作成の手順になります。virshを用いた方法と比較してかなり簡単に作成できることがわかります&lt;/p>
&lt;h2 id="vmの構築番外編">VMの構築②(番外編)
&lt;/h2>&lt;p>前の章では、cockpitで一から仮想マシンを作成しましたが、既存のVMをコピーすることで更に簡単にVMを作成することができます&lt;/p>
&lt;p>以下手順でVMのコピーを実施します&lt;/p>
&lt;ul>
&lt;li>コピー元の仮想マシンをシャットダウンする&lt;/li>
&lt;li>コピー元仮想マシンの右側三点リーダーからクローンを選択&lt;/li>
&lt;li>名前を入力してクローンをクリック&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_clone.png"
width="3313"
height="1127"
srcset="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_clone_hu_3e7c1a1e759f86ed.png 480w, http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_clone_hu_2c19a37ed118a171.png 1024w"
loading="lazy"
alt="cockpit_clone"
class="gallery-image"
data-flex-grow="293"
data-flex-basis="705px"
>&lt;/p>
&lt;p>終わりです。コピー元VMからコピーして新しいVMが作成されました&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_clone_check.png"
width="3313"
height="1127"
srcset="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_clone_check_hu_91aa3409b15b511a.png 480w, http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7vm%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_clone_check_hu_2721208c443bdc53.png 1024w"
loading="lazy"
alt="cockpit_clone_check"
class="gallery-image"
data-flex-grow="293"
data-flex-basis="705px"
>&lt;/p>
&lt;p>以上、cockpitを使って仮想マシンを作成する方法を紹介しました。&lt;br>
次回は仮想マシンがアタッチされる、仮想ネットワークについて書いていこうと思います&lt;/p></description></item><item><title>【KVMの仮想化入門③】cockpitでブラウザからVMを操作してみる</title><link>http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%8B%E3%82%89vm%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/</link><pubDate>Mon, 16 Dec 2024 00:00:00 +0000</pubDate><guid>http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%8B%E3%82%89vm%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/</guid><description>&lt;p>前回はvirshを使って、CLIからVMを構築しました。今回はVMをブラウザから操作するためのcockpitをインストールして動かして見ようと思います&lt;/p>
&lt;h2 id="cockpitとは">cockpitとは:
&lt;/h2>&lt;p>cockpitとは、下記特徴を持つソフトウェアです。今回は仮想化のために使用しますが、それはあくまでcockpitの機能の一部を利用する形となります&lt;/p>
&lt;ul>
&lt;li>Linuxシステムのサーバ管理用webサーバー&lt;/li>
&lt;li>LinuxシステムのCPU、メモリ、ネットワーク、ストレージなどのシステムリソースの使用状況をリアルタイムで監視できる&lt;/li>
&lt;li>仮想マシンの作成、起動、停止、スナップショットの作成等簡単な操作をGUIで行うことができる&lt;/li>
&lt;li>小規模な環境やシンプルな仮想化運用に適している&lt;/li>
&lt;/ul>
&lt;p>その他のソフトウェアも気になっているので、後々記事にしていければと思っています&lt;/p>
&lt;p>以下は、LinuxにCockpitをインストールして仮想マシンを確認する手順を紹介するブログのMarkdown形式のサンプルです。&lt;/p>
&lt;h2 id="cockpitのインストールと起動">cockpitのインストールと起動
&lt;/h2>&lt;p>以下のコマンドを実行して、cockpitと仮想マシンの管理に必要なパッケージをインストールします。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo apt install cockpit cockpit-machines
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>インストールが完了したら、Cockpitサービスを開始します。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo systemctl start cockpit
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="cockpit-webインターフェースにアクセス">cockpit Webインターフェースにアクセス
&lt;/h2>&lt;p>cockpitの起動が完了したため、Webブラウザから9090ポートで管理画面にアクセスできます。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">https://&amp;lt;サーバーのIPアドレス&amp;gt;:9090
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以下のようなログインページが表示されるため、ubuntuのログインユーザーでログインします&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%8B%E3%82%89vm%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_login.png"
width="3819"
height="2008"
srcset="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%8B%E3%82%89vm%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_login_hu_705692e03b346151.png 480w, http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%8B%E3%82%89vm%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_login_hu_2c58be4ea29fe51b.png 1024w"
loading="lazy"
alt="cockpit_login"
class="gallery-image"
data-flex-grow="190"
data-flex-basis="456px"
>&lt;/p>
&lt;p>ログインすると以下のような画面になります&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%8B%E3%82%89vm%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_main.png"
width="3819"
height="2008"
srcset="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%8B%E3%82%89vm%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_main_hu_3559cb7aba2540a.png 480w, http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%8B%E3%82%89vm%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_main_hu_3798cb12b4f9347d.png 1024w"
loading="lazy"
alt="cockpit_main"
class="gallery-image"
data-flex-grow="190"
data-flex-basis="456px"
>&lt;/p>
&lt;p>そして、仮想マシンのタブを開くと既に作成しているubuntu001が確認でき、&lt;br>
このページからは仮想マシンに対して以下の操作が可能となっています&lt;/p>
&lt;ul>
&lt;li>VMのインポート/新規作成&lt;/li>
&lt;li>VMの電源操作(起動、停止、再起動)&lt;/li>
&lt;li>VMの移行&lt;/li>
&lt;li>VMの削除&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%8B%E3%82%89vm%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_vms.png"
width="3819"
height="2008"
srcset="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%8B%E3%82%89vm%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_vms_hu_dbe6b9f4a7cd9def.png 480w, http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%8B%E3%82%89vm%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_vms_hu_eeae4b24e0531688.png 1024w"
loading="lazy"
alt="cockpit_vms"
class="gallery-image"
data-flex-grow="190"
data-flex-basis="456px"
>&lt;/p>
&lt;p>また、VM名をクリックすることでその仮想マシンの詳細を確認することができます&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%8B%E3%82%89vm%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_vm.png"
width="3819"
height="2008"
srcset="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%8B%E3%82%89vm%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_vm_hu_7ef115b940ff9747.png 480w, http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%8B%E3%82%89vm%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_vm_hu_79c059cef90490.png 1024w"
loading="lazy"
alt="cockpit_vm1"
class="gallery-image"
data-flex-grow="190"
data-flex-basis="456px"
>&lt;/p>
&lt;p>&lt;img src="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%8B%E3%82%89vm%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_vm2.png"
width="3819"
height="2008"
srcset="http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%8B%E3%82%89vm%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_vm2_hu_9fe8cf7d3a175b5e.png 480w, http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80cockpit%E3%81%A7%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%8B%E3%82%89vm%E3%82%92%E6%93%8D%E4%BD%9C%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/uploads/cockpit_vm2_hu_155e2c2c3faf26c8.png 1024w"
loading="lazy"
alt="cockpit_vm2"
class="gallery-image"
data-flex-grow="190"
data-flex-basis="456px"
>&lt;/p>
&lt;p>ここからVMのコンソールを操作することができるため、ここで作成したubuntu001のセットアップを行ないます&lt;br>
(この記事では本手順は省略します。わからない方は&lt;a class="link" href="https://gihyo.jp/admin/serial/01/ubuntu-recipe/0820" target="_blank" rel="noopener"
>こちら&lt;/a>を参考にしていただけると良いかもしれません。)&lt;/p>
&lt;!-- ![cockpit_vm_cdrom1](uploads/cockpit_vm_cdrom1.png) -->
&lt;!-- ![cockpit_vm_cdrom2](uploads/cockpit_vm_cdrom2.png) --></description></item><item><title>【KVMの仮想化入門②】virshでVMをデプロイしてみる</title><link>http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80virsh%E3%81%A7vm%E3%82%92%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/</link><pubDate>Wed, 11 Dec 2024 00:00:00 +0000</pubDate><guid>http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80virsh%E3%81%A7vm%E3%82%92%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B/</guid><description>&lt;p>前回はKVMの仮想化基盤を用意するところまでをやってみました。今回は&lt;code>virsh&lt;/code>を用いてCLIから仮想マシンを構築するところまでをやってみます&lt;/p>
&lt;h2 id="virshとは">virshとは
&lt;/h2>&lt;ul>
&lt;li>KVMやQEMUを利用した仮想化基盤の管理をコマンドラインから行うためのツール&lt;/li>
&lt;li>Libvirtという仮想化管理ツールをバックエンドに利用&lt;/li>
&lt;li>仮想マシンの作成、削除、起動、停止、リソースの管理などをシンプルなコマンドで実行可能&lt;/li>
&lt;/ul>
&lt;h2 id="virshで利用できる参照コマンド">virshで利用できる参照コマンド
&lt;/h2>&lt;p>&lt;code>virsh&lt;/code>には仮想化リソースを参照するための多くのコマンドが用意されています。&lt;br>
まずはよく利用しそうなコマンドを使ってみようと思います&lt;/p>
&lt;h3 id="仮想マシンの参照コマンド">仮想マシンの参照コマンド
&lt;/h3>&lt;ul>
&lt;li>&lt;code>virsh list --all&lt;/code>
&lt;ul>
&lt;li>稼働中、停止中を問わずすべてのVMを表示します(今回はまだVMを作成できていないので表示なし)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ubuntu@kvm001:~$ virsh list --all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Id Name State
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>仮にVMが存在した場合、以下のような表示になります&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ virsh list --all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Id Name State
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 12 ubuntu001 running
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - ubuntu002 shut off
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>virsh dominfo &amp;lt;VM名&amp;gt;&lt;/code>
&lt;ul>
&lt;li>指定したVMの詳細情報を表示(別途用意した環境で確認)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ virsh dominfo ubuntu001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Id: 12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: ubuntu001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">UUID: bdce429c-1284-463b-8af4-f538374a3b2d
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OS Type: hvm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">State: running
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CPU(s): 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CPU time: 10368.9s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Max memory: 3145728 KiB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Used memory: 3145728 KiB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Persistent: yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Autostart: disable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Managed save: no
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Security model: none
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Security DOI: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Messages: tainted: running with undesirable elevated privileges
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="仮想ネットワークの参照コマンド">仮想ネットワークの参照コマンド
&lt;/h3>&lt;ul>
&lt;li>&lt;code>virsh net-list&lt;/code>
&lt;ul>
&lt;li>現在有効な仮想ネットワークの一覧を表示します。&lt;/li>
&lt;li>&lt;code>default&lt;/code> という名前の仮想ネットワークがすでに作成されていることがわかります&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ubuntu@kvm001:~$ virsh net-list --all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name State Autostart Persistent
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default active yes yes
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>virsh net-dumpxml &amp;lt;ネットワーク名&amp;gt;&lt;/code>
&lt;ul>
&lt;li>指定したネットワークの設定を表示します。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ubuntu@kvm001:~$ virsh net-info default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">UUID: 61c20183-757b-402f-a92e-677072b910d0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Active: yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Persistent: yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Autostart: yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Bridge: virbr0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>この仮想ネットワークについては、今後もう少し詳細を書きたいと思っています&lt;/p>
&lt;h3 id="仮想ストレージの参照コマンド">仮想ストレージの参照コマンド
&lt;/h3>&lt;ul>
&lt;li>&lt;code>virsh pool-list&lt;/code>
&lt;ul>
&lt;li>現在利用可能なストレージプールの一覧を表示します。(今回はまだ作成できていないので表示なし)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ubuntu@kvm001:~$ virsh pool-list --all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name State Autostart
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---------------------------
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>すでに作成されていた場合、以下のような表示になります&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ virsh pool-list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Name State Autostart
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default active yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ubuntu active yes
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>virsh pool-info &amp;lt;プール名&amp;gt;&lt;/code>
&lt;ul>
&lt;li>指定したストレージプールの詳細情報を表示します。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ virsh pool-info default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">UUID: fa63badf-324b-4fa9-992c-81581e9c307f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">State: running
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Persistent: yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Autostart: yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Capacity: 456.35 GiB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Allocation: 72.34 GiB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Available: 384.00 GiB
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="virsh仮想マシンを構築する">virsh仮想マシンを構築する
&lt;/h2>&lt;p>前置きが長くなりましたが、いよいよ仮想マシンの構築に入ります。&lt;/p>
&lt;h3 id="isoの準備">isoの準備
&lt;/h3>&lt;p>今回は、ubuntuのVMを作成しようと思うので、wgetでubuntuのisoをダウンロードしておきます&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">mkdir /iso
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo wget -P /iso https://releases.ubuntu.com/24.04.1/ubuntu-24.04.1-live-server-amd64.iso
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ディスクイメージの準備">ディスクイメージの準備
&lt;/h3>&lt;p>仮想マシン用のディスクイメージを作成します。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo qemu-img create -f qcow2 /var/lib/libvirt/images/ubuntu001.qcow2 20G
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="仮想マシンのxmlファイルを作成">仮想マシンのXMLファイルを作成
&lt;/h3>&lt;p>libvirtでは、XMLを用いてVMの構成管理が行われます&lt;br>
そのため、以下の仮想マシンの構成を定義するXMLファイルを用意します&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">vi ubuntu001.xml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ファイルには以下内容を記載します&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;domain&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#39;kvm&amp;#39;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;name&amp;gt;&lt;/span>ubuntu001&lt;span class="nt">&amp;lt;/name&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;memory&lt;/span> &lt;span class="na">unit=&lt;/span>&lt;span class="s">&amp;#39;MiB&amp;#39;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>4096&lt;span class="nt">&amp;lt;/memory&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;vcpu&lt;/span> &lt;span class="na">placement=&lt;/span>&lt;span class="s">&amp;#39;static&amp;#39;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>2&lt;span class="nt">&amp;lt;/vcpu&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;os&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;type&lt;/span> &lt;span class="na">arch=&lt;/span>&lt;span class="s">&amp;#39;x86_64&amp;#39;&lt;/span> &lt;span class="na">machine=&lt;/span>&lt;span class="s">&amp;#39;pc-i440fx-6.2&amp;#39;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>hvm&lt;span class="nt">&amp;lt;/type&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;boot&lt;/span> &lt;span class="na">dev=&lt;/span>&lt;span class="s">&amp;#39;cdrom&amp;#39;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/os&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;devices&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;disk&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#39;file&amp;#39;&lt;/span> &lt;span class="na">device=&lt;/span>&lt;span class="s">&amp;#39;disk&amp;#39;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;driver&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#39;qemu&amp;#39;&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#39;qcow2&amp;#39;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;source&lt;/span> &lt;span class="na">file=&lt;/span>&lt;span class="s">&amp;#39;/var/lib/libvirt/images/ubuntu001.qcow2&amp;#39;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;target&lt;/span> &lt;span class="na">dev=&lt;/span>&lt;span class="s">&amp;#39;vda&amp;#39;&lt;/span> &lt;span class="na">bus=&lt;/span>&lt;span class="s">&amp;#39;virtio&amp;#39;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/disk&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;disk&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#39;file&amp;#39;&lt;/span> &lt;span class="na">device=&lt;/span>&lt;span class="s">&amp;#39;cdrom&amp;#39;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;driver&lt;/span> &lt;span class="na">name=&lt;/span>&lt;span class="s">&amp;#39;qemu&amp;#39;&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#39;raw&amp;#39;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;source&lt;/span> &lt;span class="na">file=&lt;/span>&lt;span class="s">&amp;#39;/iso/ubuntu-24.04.1-live-server-amd64.iso&amp;#39;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;target&lt;/span> &lt;span class="na">dev=&lt;/span>&lt;span class="s">&amp;#39;sda&amp;#39;&lt;/span> &lt;span class="na">bus=&lt;/span>&lt;span class="s">&amp;#39;sata&amp;#39;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/disk&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;interface&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#39;network&amp;#39;&lt;/span>&lt;span class="nt">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;source&lt;/span> &lt;span class="na">network=&lt;/span>&lt;span class="s">&amp;#39;default&amp;#39;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/interface&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;graphics&lt;/span> &lt;span class="na">type=&lt;/span>&lt;span class="s">&amp;#39;vnc&amp;#39;&lt;/span> &lt;span class="na">port=&lt;/span>&lt;span class="s">&amp;#39;-1&amp;#39;&lt;/span> &lt;span class="na">autoport=&lt;/span>&lt;span class="s">&amp;#39;yes&amp;#39;&lt;/span>&lt;span class="nt">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/devices&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/domain&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>XMLに記載している内容について、細かい内容は省略しますが下記設定を盛り込んでいます&lt;/p>
&lt;ul>
&lt;li>基本情報
&lt;ul>
&lt;li>&lt;code>&amp;lt;name&amp;gt;ubuntu001&amp;lt;/name&amp;gt;&lt;/code>: vm名をubuntu001とする&lt;/li>
&lt;li>&lt;code>&amp;lt;memory unit='MiB'&amp;gt;4096&amp;lt;/memory&amp;gt;&lt;/code>: 仮想マシンに割り当てるメモリ量を4096MB=2GBとする&lt;/li>
&lt;li>&lt;code>&amp;lt;vcpu placement='static'&amp;gt;2&amp;lt;/vcpu&amp;gt;&lt;/code>: 割り当てるvCPUの数を2にする&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>OSの設定 (&lt;code>&amp;lt;os&amp;gt;&lt;/code>)
&lt;ul>
&lt;li>&lt;code>&amp;lt;boot dev='cdrom'/&amp;gt;&lt;/code>: 仮想マシン起動時にCD-ROMを最初のブートデバイスとして使用するように設定&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ストレージの設定 (&lt;code>&amp;lt;disk&amp;gt;&lt;/code>)
&lt;ul>
&lt;li>仮想ディスク
&lt;ul>
&lt;li>&lt;code>&amp;lt;source file='/var/lib/libvirt/images/ubuntu001.qcow2'/&amp;gt;&lt;/code>: 作成した仮想ディスクのパスを指定&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ISOイメージ（&lt;code>&amp;lt;disk&amp;gt;&lt;/code>）
&lt;ul>
&lt;li>&lt;code>&amp;lt;disk type='file' device='cdrom'&amp;gt;&lt;/code>: ISOイメージを光学ドライブに割り当てる設定&lt;/li>
&lt;li>&lt;code>&amp;lt;source file='/iso/ubuntu-24.04.1-live-server-amd64.iso'/&amp;gt;&lt;/code>: ダウンロードしたISOイメージをソースに設定&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>ネットワーク設定 (&lt;code>&amp;lt;interface&amp;gt;&lt;/code>)
&lt;ul>
&lt;li>&lt;code>&amp;lt;interface type='network'&amp;gt;&lt;/code>: 仮想マシンのネットワークインターフェイスを設定 (NATを用いた接続)&lt;/li>
&lt;li>&lt;code>&amp;lt;source network='default'/&amp;gt;&lt;/code>: 事前定義された&lt;code>default&lt;/code>ネットワークを使用&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>詳細は下記サイトにまとまっています&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://docs.redhat.com/ja/documentation/red_hat_enterprise_linux/8/html/configuring_and_managing_virtualization/sample-virtual-machine-xml-configuration_viewing-information-about-virtual-machines#sample-virtual-machine-xml-configuration_viewing-information-about-virtual-machines" target="_blank" rel="noopener"
>7.3. 仮想マシンの XML 設定例 | Red Hat Product Documentation&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="仮想マシンの定義を読み込む">仮想マシンの定義を読み込む
&lt;/h3>&lt;p>用意したXMLファイルを読み込み、仮想マシンを定義します。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">virsh define ubuntu001.xml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ちなみに、この時点で仮想マシンが作成された状態となり、&lt;code>virsh list --all&lt;/code>でその状態が確認できます。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ubuntu@kvm001:~$ virsh list --all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Id Name State
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - ubuntu001 shut off
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="仮想マシンを起動">仮想マシンを起動
&lt;/h3>&lt;p>定義した仮想マシンを起動します。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">virsh start ubuntu001
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>起動後、以下のコマンドで仮想マシンの状態を確認します。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ubuntu@kvm001:~$ virsh list --all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Id Name State
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">3&lt;/span> myvm running
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上で仮想マシンを構築するところまでが完了しました。&lt;br>
次回はcockpitを使ってwebのGUIからVMを操作するところまでを実施します&lt;/p></description></item><item><title>【KVMの仮想化入門① 】LinuxにKVMをインストールする</title><link>http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80-linux%E3%81%ABkvm%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B/</link><pubDate>Tue, 10 Dec 2024 00:00:00 +0000</pubDate><guid>http://192.168.122.81/p/kvm%E3%81%AE%E4%BB%AE%E6%83%B3%E5%8C%96%E5%85%A5%E9%96%80-linux%E3%81%ABkvm%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B/</guid><description>&lt;p>KVM（Kernel-based Virtual Machine）について、少し勉強した上でLinuxのマシンにKVMの仮想化基盤を構築するところまでをやってみます&lt;/p>
&lt;h2 id="仮想化の概要">仮想化の概要
&lt;/h2>&lt;p>KVMについてお話する前に、前提として仮想化と、そのプラットフォームについて書いてみます。&lt;br>
仮想化とは、1つの物理コンピュータ上で複数の仮想マシン（Virtual Machine, VM）を実行する技術です。仮想化により、物理リソースの効率的な活用、アプリケーションの分離、テスト環境の作成が容易になります。&lt;/p>
&lt;h2 id="kvmについて">KVMについて
&lt;/h2>&lt;p>仮想化技術に使用されるハイパーバイザには様々なものがありますが、今回利用するKVMについてざっくりと特徴を上げると以下になります&lt;/p>
&lt;ul>
&lt;li>オープンソースとして無料で提供されている&lt;/li>
&lt;li>Linuxカーネルに統合された仮想化機能&lt;/li>
&lt;li>qemu, libvirtと組み合わせて利用される&lt;/li>
&lt;li>virsh, virt-manager, cockpit, OpenStack, oVirtなど様々な管理ツールが存在する&lt;/li>
&lt;li>AWS, GCP等のメガクラウドでも採用されている技術である&lt;/li>
&lt;/ul>
&lt;p>※ qemuについて: &lt;a class="link" href="https://gihyo.jp/dev/serial/01/vm_work/0002" target="_blank" rel="noopener"
>第2回　Linux KVMで知る仮想マシンの概要 | gihyo.jp&lt;/a>&lt;br>
※ KVM管理ツールについて: &lt;a class="link" href="https://www.designet.co.jp/faq/term/?id=S1ZN" target="_blank" rel="noopener"
>KVMとは | OSSのデージーネット&lt;/a>&lt;/p>
&lt;h2 id="kvmを用いた仮想化環境の構築">KVMを用いた仮想化環境の構築
&lt;/h2>&lt;p>以下コマンドで、必要なパッケージをインストールしていきます&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 必要なパッケージのインストール&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install -y qemu-kvm libvirt-daemon libvirt-clients bridge-utils
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 再起動&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>すごく簡単ですが、インストールしているパッケージに関しての説明は以下です&lt;/p>
&lt;ul>
&lt;li>qemu-kvm
&lt;ul>
&lt;li>KVM（仮想化）の中核となるパッケージ。必須。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>libvirt-daemon
&lt;ul>
&lt;li>仮想マシンを管理するためのバックエンドサービス。必須。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>libvirt-clients
&lt;ul>
&lt;li>仮想マシン管理用のCLIツール群。CLIから仮想マシンを操作する際に必要。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>bridge-utils
&lt;ul>
&lt;li>ブリッジネットワークの構築に使うツール群。仮想マシンをホストのブリッジネットワークに接続したい際に必要。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="インストールの確認">インストールの確認
&lt;/h2>&lt;p>以下のコマンドでインストールが成功しているか確認します。&lt;/p>
&lt;h3 id="kvmの状態確認">KVMの状態確認
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">ubuntu@kvm001:~$ sudo kvm-ok
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO: /dev/kvm exists
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">KVM acceleration can be used
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="libvirtサービスの状態確認">libvirtサービスの状態確認
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">ubuntu@kvm001:~$ sudo systemctl status libvirtd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">○ libvirtd.service - libvirt legacy monolithic daemon
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Loaded: loaded &lt;span class="o">(&lt;/span>/usr/lib/systemd/system/libvirtd.service&lt;span class="p">;&lt;/span> enabled&lt;span class="p">;&lt;/span> preset: enabled&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Active: inactive &lt;span class="o">(&lt;/span>dead&lt;span class="o">)&lt;/span> since Fri 2024-12-13 03:18:37 UTC&lt;span class="p">;&lt;/span> 9s ago
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ~~以下省略~~&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>以上で、KVMとその関連ツールのインストールは完了です。&lt;/p>
&lt;p>次回はこのKVM環境でvirshを使って仮想マシンを構築してみます&lt;/p></description></item><item><title>Archives</title><link>http://192.168.122.81/archives/</link><pubDate>Sun, 06 Mar 2022 00:00:00 +0000</pubDate><guid>http://192.168.122.81/archives/</guid><description/></item><item><title>Links</title><link>http://192.168.122.81/links/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>http://192.168.122.81/links/</guid><description>&lt;p>To use this feature, add &lt;code>links&lt;/code> section to frontmatter.&lt;/p>
&lt;p>This page&amp;rsquo;s frontmatter:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">links&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">title&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">GitHub&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">description&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">GitHub is the world&amp;#39;s largest software development platform.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">website&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://github.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">title&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TypeScript&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">description&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TypeScript is a typed superset of JavaScript that compiles to plain JavaScript.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">website&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://www.typescriptlang.org&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ts-logo-128.jpg&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>image&lt;/code> field accepts both local and external images.&lt;/p></description></item><item><title>Search</title><link>http://192.168.122.81/search/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>http://192.168.122.81/search/</guid><description/></item></channel></rss>